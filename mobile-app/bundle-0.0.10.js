!function e(t,n,i){function r(s,a){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[s]={exports:{}};t[s][0].call(u.exports,function(e){var n=t[s][1][e];return r(n||e)},u,u.exports,e,t,n,i)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(e,t,n){"use strict";function i(e){var t=Math.min(Math.floor(3*e*255),255).toString(16);return 1===t.length?"0"+t:t}t.exports=function(e){var t;return function(n){t||(t=n);var r=(n-n%e)/t;return"#"+(r>1?r>1.33?"0000ff":"00"+i(1.33-r)+"ff":r<=.33?"ff"+i(r)+"00":r<=.66?i(.66-r)+"ff00":"00ff"+i(r-.66))}}},{}],2:[function(e,t,n){"use strict";var i=e("./story"),r=e("./screen-text"),o=e("./screen-restore");n.create=function(e){function t(t){e.innerHTML="";var n=new XMLHttpRequest;n.onload=function(){if(200===this.status)try{i.fromJson(JSON.parse(this.responseText))(e),"tour.json"!==t&&localStorage.setItem("story",t)}catch(n){r.create(e,"## Failed to load story!\n\n"+t+"\n\n```"+n.toString()+"\n```")}else r.create(e,"## "+this.status+"\n\n"+t)},n.open("get",t,!0),n.send()}return{load:function(n){function i(){localStorage.clear(),t(n)}var r=localStorage.getItem("story");r&&localStorage.getItem("screen")?o.create(e,function(){t(r)},i):i()}}}},{"./screen-restore":10,"./screen-text":12,"./story":14}],3:[function(e,t,n){"use strict";function i(e){this.center=e}function r(e,t){i.call(this,e),this.radius=t}function o(e){i.call(this,s.getCenter(e)),this.coords=e}var s=e("geolib"),a=e("inherits");i.prototype.distance=function(e){return s.getDistance(this.center,e)},n.Shape=i,a(r,i),r.prototype.within=function(e){return this.distance(e)<=this.radius},n.Circle=r,a(o,i),o.prototype.within=function(e){return s.isPointInside(e,this.coords)},n.Polygon=o,n.fromJson=function(e){if("circle"===e.type)return new r(e.center,e.radius);if("polygon"===e.type)return new o(e.coords);throw new Error("Unkown type: "+e.type)}},{geolib:18,inherits:20}],4:[function(e,t,n){"use strict";var i=e("animatify");n.create=function(e,t,n,r){var o=document.createElement("div");return o.innerHTML=t,o.classList.add("message",n),e.appendChild(o),i(o,"bounceInDown",function(){o.classList.add("animated","infinite","pulse"),r&&r()}),{destroy:function(t){o.classList.remove("animated","infinite","pulse"),i(o,"bounceOutUp",function(){e.removeChild(o),t&&t()})}}}},{animatify:15}],5:[function(e,t,n){"use strict";var i=e("hyperglue"),r=e("marked"),o=e("./screen");n.create=function(e){var t=i('<div class="screen">\n  <div class="text"></div>\n  <form class="story" action="">\n    <input type="text" name="story" placeholder="Paste story URL here" autocomplete="off"/>\n  </form>\n</div>\n',{".text":{_html:r("## Location based stories\n\nGeo Tales lets you create and play interactive, location based stories.\n\nStories can be created by anybody and hosted for free on GitHub. Please see\nthe [Geo Tales project page][project] for details on how to build stories.\n\nTo play a story, enter the gist URL below, or check out the [screens tour][].\n\n[project]: https://github.com/geo-tales/geo-tales-mobile/blob/master/README.md\n[screens tour]: ?story=tour.json\n")}});e.appendChild(t),o.show([t.querySelector(".text"),t.querySelector("form")])}},{"./screen":13,hyperglue:19,marked:22}],6:[function(e,t,n){"use strict";function i(e){return e<10?"0"+e:e}function r(e){var t=[],n=Math.floor(e/36e5);e-=36e5*n;var r=Math.floor(e/6e4);e-=6e4*r;var o=Math.floor(e/1e3);return t.push(n,i(r),i(o)),t.join(":")}var o=e("hyperglue"),s=e("marked"),a=e("./screen");n.create=function(e,t,n,i){var l=[];n.time&&l.push({".name":"Time:",".value":r(n.time)}),"number"==typeof n.points&&l.push({".name":"Points:",".value":String(n.points)});var c=o('<div class="screen">\n  <div class="text"></div>\n  <div class="results">\n    <ul>\n      <li class="result">\n        <span class="name">&nbsp;</span>\n        <span class="value">&nbsp;</span>\n      </li>\n    </ul>\n  </div>\n  <div class="footer">\n    <button class="close">Close</button>\n  </div>\n</div>\n',{".text":{_html:s(t||"## Congratulations!\n\nYou reached the end of this story.")},".result":l});e.appendChild(c);var u=c.querySelector(".footer"),h=[c.querySelector(".text"),c.querySelector(".results"),u];u.querySelector(".close").onclick=function(){a.hide(h,i)},a.show(h)}},{"./screen":13,hyperglue:19,marked:22}],7:[function(e,t,n){"use strict";var i=e("hyperglue"),r=e("marked"),o=e("animatify"),s=e("./screen");n.create=function(e,t,n,a){function l(){f.push(d),s.hide(f,a)}var c=i('<div class="screen">\n  <div class="text"></div>\n  <form action="#" onsubmit="return false;">\n    <input name="answer" autocomplete="off"/>\n  </form>\n  <div class="footer">\n    <button class="next">&#8594;</button>\n  </div>\n</div>\n',{".text":{_html:r(t)}}),u=c.querySelector(".text"),h=c.querySelector("form"),d=c.querySelector(".footer"),p=h.querySelector("input[name=answer]");p.type="number"==typeof n.answer?"number":"text",d.style.display="none";var f=[u,h],g=String(n.answer).toLowerCase(),m=!1;p.onchange=function(){m||(p.value.trim().toLowerCase()===g?(p.blur(),p.classList.remove("incorrect"),p.classList.add("correct"),m=!0,d.style.display="block",o(p,"tada",{delay:".5s"}),o(d,"bounceInUp",{delay:"1s"}),d.querySelector(".next").onclick=l):(p.classList.add("incorrect"),o(p,"shake",{duration:".7s"})))},p.onkeydown=function(){p.classList.remove("incorrect")},e.appendChild(c),s.show(f)}},{"./screen":13,animatify:15,hyperglue:19,marked:22}],8:[function(e,t,n){"use strict";var i=e("hyperglue"),r=e("marked"),o=e("animatify"),s=e("./screen");n.create=function(e,t,n,a){function l(){var e=d.querySelector("input[name=choice]:checked");e&&(f.push(p),s.hide(f,function(){a(n[e.value])}))}var c=n.map(function(e,t){return{".label":{_html:r(e.text).trim().replace(/^<p>|<\/p>$/g,"")},input:{value:String(t)}}}),u=i('<div class="screen">\n  <div class="text"></div>\n  <form action="#">\n    <ul>\n      <li class="choice">\n        <label>\n          <input type="radio" name="choice">\n          <span class="label">&nbsp;</span>\n        </label>\n      </li>\n    </ul>\n  </form>\n  <div class="footer">\n    <button class="next">&#8594;</button>\n  </div>\n</div>\n',{".text":{_html:r(t)},".choice":c}),h=u.querySelector(".text"),d=u.querySelector("form"),p=u.querySelector(".footer");p.style.display="none";var f=[h,d],g=!1;Array.prototype.slice.call(d.querySelectorAll("input")).forEach(function(e){e.onchange=function(){g||(g=!0,p.style.display="block",o(p,"bounceInUp"),p.querySelector(".next").onclick=l)}}),e.appendChild(u),s.show(f)}},{"./screen":13,animatify:15,hyperglue:19,marked:22}],9:[function(e,t,n){"use strict";var i=e("events"),r=e("hyperglue"),o=e("animatify"),s=e("locatify"),a=e("./color"),l=e("./message"),c=e("./screen");n.create=function(e,t,n,u){function h(){L&&(L.destroy(),L=null)}function d(){x=_.latitude,k=_.longitude;var e=C-k,t=Math.cos(x)*Math.sin(E)-Math.sin(x)*Math.cos(E)*Math.cos(e),n=Math.sin(e)*Math.cos(E),i=180*Math.atan2(t,n)/Math.PI-w+180;i<0&&(i+=360);var r="rotate("+Math.round(i)+"deg)";m.style.transform=r,m.style.webkitTransform=r,D||(D=!0,R=!0,m.style.visibility="visible",o(m,"zoomIn",function(){R=!1,d()}))}function p(){var e=_.accuracy,t=e<20?"":"Accuracy: ";v.innerHTML=t+Math.round(e||1e4)+" m"}var f=r('<div class="screen">\n  <div class="compass">\n    <div class="arrow">&#10143;</div>\n  </div>\n  <div class="distance"></div>\n  <div class="accuracy"></div>\n  <div class="footer">\n    <button class="next">&#8594;</button>\n  </div>\n</div>\n',{}),g=f.querySelector(".compass"),m=f.querySelector(".arrow"),v=f.querySelector(".accuracy"),y=f.querySelector(".distance"),b=f.querySelector(".footer");b.style.display="none",!1===n.compass&&(g.style.display="none"),e.appendChild(f);var x,k,w,_,L,M,S,E=t.center.latitude,C=t.center.longitude,D=!1,R=!1;n.demo?(M=new i.EventEmitter,M.destroy=function(){M.removeAllListeners()}):(M=s.create(),S=setTimeout(function(){L||(h(),L=l.create(e,"Waiting for position data","info"))},3e3));var A=n.colorSteps?a(n.colorSteps):null;if(M.on("error",function(t){clearTimeout(S),h(),L=l.create(e,t.message,"warning"),D=!1,m.style.visibility="hidden",document.documentElement.style.backgroundColor="inherit"}),M.on("position",function(i){if(clearTimeout(S),h(),_=i,!R){var r=t.distance(i);!1!==n.distance&&(y.innerHTML=r+" m",p()),void 0!==w&&d();var o=i.accuracy&&i.accuracy<20;if(o?v.classList.contains("bad")&&(v.classList.remove("bad"),!1===n.distance&&(v.innerHTML="")):(v.classList.add("bad"),!1===n.distance&&p()),A&&(document.documentElement.style.backgroundColor=o?A(r):"inherit"),o&&t.within(i)){L&&(L.destroy(),L=null),M.destroy();var s=[];!1!==n.compass&&s.push(g),!1!==n.distance&&s.push(y,v),c.hide(s,function(){g.style.display="none",y.style.display="none",v.style.display="none"}),b.style.display="block",c.show([b]),setTimeout(function(){var t=l.create(e,"Location reached!","info",function(){b.querySelector(".next").onclick=function(){c.hide([b],function(){b.style.display="none"}),t.destroy(function(){document.documentElement.style.backgroundColor="inherit",u()})}})},500)}}}),!1!==n.compass&&M.on("heading",function(e){e&&(w=e,_&&!R&&d())}),n.demo){var T={latitude:t.center.latitude-5e-4,longitude:t.center.longitude,accuracy:5},I=360;M.emit("heading",I),M.emit("position",T);var q=function(){setTimeout(function(){M.emit("heading",I),I-=3,M.emit("position",T),T.latitude+=2e-5,T.latitude<t.center.latitude&&q()},50)};setTimeout(q,1e3)}}},{"./color":1,"./message":4,"./screen":13,animatify:15,events:17,hyperglue:19,locatify:21}],10:[function(e,t,n){"use strict";var i=e("hyperglue"),r=e("./screen");n.create=function(e,t,n){var o=i('<div class="screen">\n  <div class="text">\n    <h2>Continue last story?</h2>\n    <p>Do you want to continue playing the last story?</p>\n  </div>\n  <div class="footer">\n    <button class="continue">Continue</button>\n    <button class="discard">Discard</button>\n  </div>\n</div>\n',{});e.appendChild(o);var s=o.querySelector(".footer"),a=[o.querySelector(".text"),s];s.querySelector(".continue").onclick=function(){r.hide(a,t)},s.querySelector(".discard").onclick=function(){r.hide(a,n)},r.show(a)}},{"./screen":13,hyperglue:19}],11:[function(e,t,n){"use strict";function i(){o&&(o.destroy(),o=null)}function r(e,t,n,r){var o=s(d,{".text":{_html:a("## Go to start location\n\n- Latitude: `"+t.center.latitude+"`\n- Longitude: `"+t.center.longitude+"`")}}),l=o.querySelector(".footer"),c=[o.querySelector(".text"),l];l.querySelector(".next").onclick=function(){n.destroy(),i(),u.hide(c,function(){e.innerHTML="",window.scrollTo(0,0),h.create(e,t,{},r)})},e.appendChild(o),u.show(c)}var o,s=e("hyperglue"),a=e("marked"),l=e("locatify"),c=e("./message"),u=e("./screen"),h=e("./screen-navigate"),d='<div class="screen">\n  <div class="text"></div>\n  <div class="footer">\n    <button class="next">Go!</button>\n  </div>\n</div>\n';n.create=function(e,t,n){var s=!1,a=l.create(e),u=setTimeout(function(){o||(i(),o=c.create(e,"Waiting for position data","info"))},3e3);a.on("error",function(t){clearTimeout(u),i(),o=c.create(e,t.message,"warning")}),a.on("position",function(o){clearTimeout(u),i(),o.accuracy<20&&t.within(o)?(a.destroy(),s&&(e.innerHTML="",window.scrollTo(0,0)),n()):s||(s=!0,r(e,t,a,n))})}},{"./message":4,"./screen":13,"./screen-navigate":9,hyperglue:19,locatify:21,marked:22}],12:[function(e,t,n){"use strict";var i=e("hyperglue"),r=e("marked"),o=e("./screen");n.create=function(e,t,n){var s=i('<div class="screen">\n  <div class="text"></div>\n  <div class="footer">\n    <button class="next">&#8594;</button>\n  </div>\n</div>\n',{".text":{_html:r(t)}}),a=s.querySelector(".footer"),l=[s.querySelector(".text")];n?(l.push(a),a.querySelector(".next").onclick=function(){o.hide(l,n)}):a.style.display="none",e.appendChild(s),o.show(l)}},{"./screen":13,hyperglue:19,marked:22}],13:[function(e,t,n){"use strict";var i=e("animatify");n.show=function(e){var t=0;e.forEach(function(e){i(e,"bounceInUp",{delay:t+"s"}),t+=.2})},n.hide=function(e,t){if(!e.length)return void t();var n=0;e.reverse().forEach(function(r,o){i(r,"bounceOutDown",{delay:n+"s"},o===e.length-1?t:function(){r.style.display="none"}),n+=.2})}},{animatify:15}],14:[function(e,t,n){"use strict";function i(e,t){throw new Error('Screen "'+e+'" '+t)}function r(e,t,n){t[n]||i(e,"has no "+n)}function o(e,t,n){e[n]||i(t,'has unknown next "'+n+'"')}function s(e,t){function n(e){var t=l.indexOf(e);-1!==t&&l.splice(t,1)}var s=!1,a=Object.keys(t),l=Object.keys(e);if(a.splice(a.indexOf("start"),1),n("start"),Object.keys(e).filter(function(l){var c=e[l];switch(r(l,c,"type"),c.type){case"text":r(l,c,"text"),r(l,c,"next"),o(e,l,c.next),n(c.next);break;case"input":r(l,c,"text"),r(l,c,"answer"),r(l,c,"next"),o(e,l,c.next),n(c.next);break;case"choices":r(l,c,"text"),r(l,c,"choices"),c.next&&(o(e,l,c.next),n(c.next)),c.choices.forEach(function(t){t.text||i(l,"has choice without text"),c.next||t.next||i(l,"has choice without next"),t.next&&!e[t.next]&&i(l,'has choice with unknown next "'+t.next+'"'),t.next&&n(t.next)});break;case"navigate":r(l,c,"location");t[c.location]||i(l,'has unknown location "'+c.location+'"');var u=a.indexOf(c.location);-1!==u&&a.splice(u,1),r(l,c,"next"),o(e,l,c.next),n(c.next);break;case"finish":s=!0;break;default:i(l,'has unknown type "'+c.type+'"')}}),a.length)throw new Error('Location "'+a[0]+'" is not used');if(l.length)throw new Error('Screen "'+l[0]+'" is not used');if(!s)throw new Error('Missing "finish" screen')}function a(e,t,n,i,r){localStorage.setItem("screen",t);var o=e[t];switch(o.type){case"text":c.create(n,o.text,function(){n.innerHTML="",window.scrollTo(0,0),a(e,o.next,n,i,r)});break;case"input":u.create(n,o.text,{answer:o.answer},function(){n.innerHTML="",window.scrollTo(0,0),a(e,o.next,n,i,r)});break;case"choices":h.create(n,o.text,o.choices,function(t){if(n.innerHTML="",window.scrollTo(0,0),t.hasOwnProperty("points")){var s=localStorage.getItem("points");s=s?parseInt(s,10):0,localStorage.setItem("points",String(s+t.points))}a(e,t.next||o.next,n,i,r)});break;case"navigate":var s=i[o.location],l=o.options||{};r.demo&&(l.demo=!0),d.create(n,s,l,function(){n.innerHTML="",window.scrollTo(0,0),a(e,o.next,n,i,r)});break;case"finish":var f=parseInt(localStorage.getItem("startTime"),10),m={time:(new Date).getTime()-f},v=localStorage.getItem("points");v&&(m.points=parseInt(v,10)),p.create(n,o.text,m,function(){n.innerHTML="",window.scrollTo(0,0),g.create(n)}),localStorage.clear()}}var l=e("./location-model"),c=e("./screen-text"),u=e("./screen-input"),h=e("./screen-multiple-choice"),d=e("./screen-navigate"),p=e("./screen-finish"),f=e("./screen-start"),g=e("./screen-default");n.fromJson=function(e){function t(t,i){localStorage.getItem("startTime")||localStorage.setItem("startTime",String((new Date).getTime())),a(e.screens,i||"start",t,n,{demo:e.demo})}if(!e.locations)throw new Error("No locations");if(!e.screens)throw new Error("No screens");if(!e.locations.start)throw new Error('Missing "start" location');if(!e.screens.start)throw new Error('Missing "start" screen');var n={};return Object.keys(e.locations).forEach(function(t){n[t]=l.fromJson(e.locations[t])}),s(e.screens,n),function(i){var r=localStorage.getItem("screen");e.demo||r?t(i,r):f.create(i,n.start,function(){i.innerHTML="",window.scrollTo(0,0),t(i)})}}},{"./location-model":3,"./screen-default":5,"./screen-finish":6,"./screen-input":7,"./screen-multiple-choice":8,"./screen-navigate":9,"./screen-start":11,"./screen-text":12}],15:[function(e,t,n){"use strict";function i(e,t,n,i){function u(){e.removeEventListener(r,u),e.classList.remove("animated"),e.classList.remove(t),(n.delay||n.duration||n.iterationCount)&&(e.style[l]=""),i&&i()}if("function"==typeof n?(i=n,n={}):n||(n={}),c)return void(i&&i());n.delay&&(e.style[s]=n.delay),n.duration&&(e.style[o]=n.duration),n.iterationCount&&(e.style[a]=n.iterationCount),e.classList.add("animated"),e.classList.add(t),e.addEventListener(r,u)}var r,o,s,a,l;!function(){var e,t,n=document.createElement("div"),i={animation:["animationend","animationDuration","animationDelay","animationIterationCount","animation"],MozAnimation:["animationend","mozAnimationDuration","mozAnimationDelay","mozAnimationIterationCount","mozAnimation"],WebkitAnimation:["webkitAnimationEnd","webkitAnimationDuration","webkitAnimationDelay","webkitAnimationIterationCount","webkitAnimation"]};for(e in i)if(i.hasOwnProperty(e)&&void 0!==n.style[e])return t=i[e],r=t[0],o=t[1],s=t[2],a=t[3],void(l=t[4])}();var c=!1;i.disable=function(){c=!0},t.exports=i},{}],16:[function(e,t,n){function i(e){if("string"!=typeof e)throw new TypeError("String expected");var t=/<([\w:]+)/.exec(e);if(!t)throw new Error("No elements were generated.");var n=t[1];if("body"==n){var i=document.createElement("html");return i.innerHTML=e,[i.removeChild(i.lastChild)]}var s=o[n]||o._default,a=s[0],l=s[1],c=s[2],i=document.createElement("div");for(i.innerHTML=l+e+c;a--;)i=i.lastChild;return r(i.children)}function r(e){for(var t=[];e.length;)t.push(e[0].parentNode.removeChild(e[0]));return t}t.exports=i;var o={option:[1,'<select multiple="multiple">',"</select>"],optgroup:[1,'<select multiple="multiple">',"</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tbody:[1,"<table>","</table>"],tfoot:[1,"<table>","</table>"],colgroup:[1,"<table>","</table>"],caption:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],th:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],_default:[0,"",""]}},{}],17:[function(e,t,n){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function o(e){return"number"==typeof e}function s(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}t.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(e){if(!o(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},i.prototype.emit=function(e){var t,n,i,o,l,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[e],a(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(i=arguments.length,o=new Array(i-1),l=1;l<i;l++)o[l-1]=arguments[l];n.apply(this,o)}else if(s(n)){for(i=arguments.length,o=new Array(i-1),l=1;l<i;l++)o[l-1]=arguments[l];for(c=n.slice(),i=c.length,l=0;l<i;l++)c[l].apply(this,o)}return!0},i.prototype.addListener=function(e,t){var n;if(!r(t))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?s(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,s(this._events[e])&&!this._events[e].warned){var n;n=a(this._maxListeners)?i.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())}return this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(e,t){function n(){this.removeListener(e,n),i||(i=!0,t.apply(this,arguments))}if(!r(t))throw TypeError("listener must be a function");var i=!1;return n.listener=t,this.on(e,n),this},i.prototype.removeListener=function(e,t){var n,i,o,a;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],o=n.length,i=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(s(n)){for(a=o;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){i=a;break}if(i<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},i.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],r(n))this.removeListener(e,n);else for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},i.prototype.listeners=function(e){return this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},i.listenerCount=function(e,t){return e._events&&e._events[t]?r(e._events[t])?1:e._events[t].length:0}},{}],18:[function(e,t,n){!function(e,n){"use strict";function i(){}i.TO_RAD=Math.PI/180,i.TO_DEG=180/Math.PI,i.PI_X2=2*Math.PI,i.PI_DIV4=Math.PI/4;var r=Object.create(i.prototype,{version:{value:"2.0.23"},radius:{value:6378137},minLat:{value:-90},maxLat:{value:90},minLon:{value:-180},maxLon:{value:180},sexagesimalPattern:{value:/^([0-9]{1,3})°\s*([0-9]{1,3}(?:\.(?:[0-9]{1,2}))?)'\s*(([0-9]{1,3}(\.([0-9]{1,4}))?)"\s*)?([NEOSW]?)$/},measures:{value:Object.create(Object.prototype,{m:{value:1},km:{value:.001},cm:{value:100},mm:{value:1e3},mi:{value:1/1609.344},sm:{value:1/1852.216},ft:{value:100/30.48},in:{value:100/2.54},yd:{value:1/.9144}})},prototype:{value:i.prototype},extend:{value:function(e,t){for(var n in e)void 0!==r.prototype[n]&&!0!==t||("function"==typeof e[n]&&"function"==typeof e[n].bind?r.prototype[n]=e[n].bind(r):r.prototype[n]=e[n])}}});void 0===Number.prototype.toRad&&(Number.prototype.toRad=function(){return this*i.TO_RAD}),void 0===Number.prototype.toDeg&&(Number.prototype.toDeg=function(){return this*i.TO_DEG}),r.extend({decimal:{},sexagesimal:{},distance:null,getKeys:function(e){if("[object Array]"==Object.prototype.toString.call(e))return{longitude:e.length>=1?0:void 0,latitude:e.length>=2?1:void 0,elevation:e.length>=3?2:void 0};var t=function(t){var n;return t.every(function(t){return"object"!=typeof e||(!e.hasOwnProperty(t)||function(){return n=t,!1}())}),n},n=t(["lng","lon","longitude"]),i=t(["lat","latitude"]),r=t(["alt","altitude","elevation","elev"]);return void 0!==i||void 0!==n||void 0!==r?{latitude:i,longitude:n,elevation:r}:void 0},getLat:function(e,t){return!0===t?e[this.getKeys(e).latitude]:this.useDecimal(e[this.getKeys(e).latitude])},latitude:function(e){return this.getLat.call(this,e)},getLon:function(e,t){return!0===t?e[this.getKeys(e).longitude]:this.useDecimal(e[this.getKeys(e).longitude])},longitude:function(e){return this.getLon.call(this,e)},getElev:function(e){return e[this.getKeys(e).elevation]},elevation:function(e){return this.getElev.call(this,e)},coords:function(e,t){var n={latitude:!0===t?e[this.getKeys(e).latitude]:this.useDecimal(e[this.getKeys(e).latitude]),longitude:!0===t?e[this.getKeys(e).longitude]:this.useDecimal(e[this.getKeys(e).longitude])},i=e[this.getKeys(e).elevation];return void 0!==i&&(n.elevation=i),n},ll:function(e,t){return this.coords.call(this,e,t)},validate:function(e){var t=this.getKeys(e);if(void 0===t||void 0===t.latitude||"undefined"===t.longitude)return!1;var n=e[t.latitude],i=e[t.longitude];return!(void 0===n||!this.isDecimal(n)&&!this.isSexagesimal(n))&&(!(void 0===i||!this.isDecimal(i)&&!this.isSexagesimal(i))&&(n=this.useDecimal(n),i=this.useDecimal(i),!(n<this.minLat||n>this.maxLat||i<this.minLon||i>this.maxLon)))},getDistance:function(e,t,n,i){n=Math.floor(n)||1,i=Math.floor(i)||0;var o,s,a,l,c,u,h,d=this.coords(e),p=this.coords(t),f=6378137,g=6356752.314245,m=1/298.257223563,v=(p.longitude-d.longitude).toRad(),y=Math.atan((1-m)*Math.tan(parseFloat(d.latitude).toRad())),b=Math.atan((1-m)*Math.tan(parseFloat(p.latitude).toRad())),x=Math.sin(y),k=Math.cos(y),w=Math.sin(b),_=Math.cos(b),L=v,M=100;do{var S=Math.sin(L),E=Math.cos(L);if(0===(u=Math.sqrt(_*S*(_*S)+(k*w-x*_*E)*(k*w-x*_*E))))return r.distance=0;o=x*w+k*_*E,s=Math.atan2(u,o),a=k*_*S/u,l=1-a*a,c=o-2*x*w/l,isNaN(c)&&(c=0);var C=m/16*l*(4+m*(4-3*l));h=L,L=v+(1-C)*m*a*(s+C*u*(c+C*o*(2*c*c-1)))}while(Math.abs(L-h)>1e-12&&--M>0);if(0===M)return NaN;var D=l*(f*f-g*g)/(g*g),R=1+D/16384*(4096+D*(D*(320-175*D)-768)),A=D/1024*(256+D*(D*(74-47*D)-128)),T=A*u*(c+A/4*(o*(2*c*c-1)-A/6*c*(4*u*u-3)*(4*c*c-3))),I=g*R*(s-T);if(I=I.toFixed(i),void 0!==this.elevation(e)&&void 0!==this.elevation(t)){var q=Math.abs(this.elevation(e)-this.elevation(t));I=Math.sqrt(I*I+q*q)}return this.distance=Math.round(I*Math.pow(10,i)/n)*n/Math.pow(10,i)},getDistanceSimple:function(e,t,n){n=Math.floor(n)||1;var i=Math.round(Math.acos(Math.sin(this.latitude(t).toRad())*Math.sin(this.latitude(e).toRad())+Math.cos(this.latitude(t).toRad())*Math.cos(this.latitude(e).toRad())*Math.cos(this.longitude(e).toRad()-this.longitude(t).toRad()))*this.radius);return r.distance=Math.floor(Math.round(i/n)*n)},getCenter:function(e){var t=e;if("object"==typeof e&&!(e instanceof Array)){t=[];for(var n in e)t.push(this.coords(e[n]))}if(!t.length)return!1;var r,o,s,a=0,l=0,c=0;t.forEach(function(e){r=this.latitude(e).toRad(),o=this.longitude(e).toRad(),a+=Math.cos(r)*Math.cos(o),l+=Math.cos(r)*Math.sin(o),c+=Math.sin(r)},this);var u=t.length;return a/=u,l/=u,c/=u,o=Math.atan2(l,a),s=Math.sqrt(a*a+l*l),r=Math.atan2(c,s),{latitude:(r*i.TO_DEG).toFixed(6),longitude:(o*i.TO_DEG).toFixed(6)}},getBounds:function(e){if(!e.length)return!1;var t=this.elevation(e[0]),n={maxLat:-1/0,minLat:1/0,maxLng:-1/0,minLng:1/0};void 0!==t&&(n.maxElev=0,n.minElev=1/0);for(var i=0,r=e.length;i<r;++i)n.maxLat=Math.max(this.latitude(e[i]),n.maxLat),n.minLat=Math.min(this.latitude(e[i]),n.minLat),n.maxLng=Math.max(this.longitude(e[i]),n.maxLng),n.minLng=Math.min(this.longitude(e[i]),n.minLng),t&&(n.maxElev=Math.max(this.elevation(e[i]),n.maxElev),n.minElev=Math.min(this.elevation(e[i]),n.minElev));return n},getCenterOfBounds:function(e){var t=this.getBounds(e),n=t.minLat+(t.maxLat-t.minLat)/2,i=t.minLng+(t.maxLng-t.minLng)/2;return{latitude:parseFloat(n.toFixed(6)),longitude:parseFloat(i.toFixed(6))}},getBoundsOfDistance:function(e,t){var n,r,o=this.latitude(e),s=this.longitude(e),a=o.toRad(),l=s.toRad(),c=t/this.radius,u=a-c,h=a+c,d=this.maxLat.toRad(),p=this.minLat.toRad(),f=this.maxLon.toRad(),g=this.minLon.toRad();if(u>p&&h<d){var m=Math.asin(Math.sin(c)/Math.cos(a));n=l-m,n<g&&(n+=i.PI_X2),r=l+m,r>f&&(r-=i.PI_X2)}else u=Math.max(u,p),h=Math.min(h,d),n=g,r=f;return[{latitude:u.toDeg(),longitude:n.toDeg()},{latitude:h.toDeg(),longitude:r.toDeg()}]},isPointInside:function(e,t){for(var n=!1,i=-1,r=t.length,o=r-1;++i<r;o=i)(this.longitude(t[i])<=this.longitude(e)&&this.longitude(e)<this.longitude(t[o])||this.longitude(t[o])<=this.longitude(e)&&this.longitude(e)<this.longitude(t[i]))&&this.latitude(e)<(this.latitude(t[o])-this.latitude(t[i]))*(this.longitude(e)-this.longitude(t[i]))/(this.longitude(t[o])-this.longitude(t[i]))+this.latitude(t[i])&&(n=!n);return n},preparePolygonForIsPointInsideOptimized:function(e){for(var t=0,n=e.length-1;t<e.length;t++)this.longitude(e[n])===this.longitude(e[t])?(e[t].constant=this.latitude(e[t]),e[t].multiple=0):(e[t].constant=this.latitude(e[t])-this.longitude(e[t])*this.latitude(e[n])/(this.longitude(e[n])-this.longitude(e[t]))+this.longitude(e[t])*this.latitude(e[t])/(this.longitude(e[n])-this.longitude(e[t])),e[t].multiple=(this.latitude(e[n])-this.latitude(e[t]))/(this.longitude(e[n])-this.longitude(e[t]))),n=t},isPointInsideWithPreparedPolygon:function(e,t){for(var n=!1,i=this.longitude(e),r=this.latitude(e),o=0,s=t.length-1;o<t.length;o++)(this.longitude(t[o])<i&&this.longitude(t[s])>=i||this.longitude(t[s])<i&&this.longitude(t[o])>=i)&&(n^=i*t[o].multiple+t[o].constant<r),s=o;return n},isInside:function(){return this.isPointInside.apply(this,arguments)},isPointInCircle:function(e,t,n){return this.getDistance(e,t)<n},withinRadius:function(){return this.isPointInCircle.apply(this,arguments)},getRhumbLineBearing:function(e,t){var n=this.longitude(t).toRad()-this.longitude(e).toRad(),r=Math.log(Math.tan(this.latitude(t).toRad()/2+i.PI_DIV4)/Math.tan(this.latitude(e).toRad()/2+i.PI_DIV4));return Math.abs(n)>Math.PI&&(n=n>0?-1*(i.PI_X2-n):i.PI_X2+n),(Math.atan2(n,r).toDeg()+360)%360},getBearing:function(e,t){return t.latitude=this.latitude(t),t.longitude=this.longitude(t),e.latitude=this.latitude(e),e.longitude=this.longitude(e),(Math.atan2(Math.sin(t.longitude.toRad()-e.longitude.toRad())*Math.cos(t.latitude.toRad()),Math.cos(e.latitude.toRad())*Math.sin(t.latitude.toRad())-Math.sin(e.latitude.toRad())*Math.cos(t.latitude.toRad())*Math.cos(t.longitude.toRad()-e.longitude.toRad())).toDeg()+360)%360},getCompassDirection:function(e,t,n){var i,r;switch(r="circle"==n?this.getBearing(e,t):this.getRhumbLineBearing(e,t),Math.round(r/22.5)){case 1:i={exact:"NNE",rough:"N"};break;case 2:i={exact:"NE",rough:"N"};break;case 3:i={exact:"ENE",rough:"E"};break;case 4:i={exact:"E",rough:"E"};break;case 5:i={exact:"ESE",rough:"E"};break;case 6:i={exact:"SE",rough:"E"};break;case 7:i={exact:"SSE",rough:"S"};break;case 8:i={exact:"S",rough:"S"};break;case 9:i={exact:"SSW",rough:"S"};break;case 10:i={exact:"SW",rough:"S"};break;case 11:i={exact:"WSW",rough:"W"};break;case 12:i={exact:"W",rough:"W"};break;case 13:i={exact:"WNW",rough:"W"};break;case 14:i={exact:"NW",rough:"W"};break;case 15:i={exact:"NNW",rough:"N"};break;default:i={exact:"N",rough:"N"}}return i.bearing=r,i},getDirection:function(e,t,n){return this.getCompassDirection.apply(this,arguments)},orderByDistance:function(e,t){return Object.keys(t).map(function(n){var i=this.getDistance(e,t[n]),r=Object.create(t[n]);return r.distance=i,r.key=n,r},this).sort(function(e,t){return e.distance-t.distance})},isPointInLine:function(e,t,n){return(this.getDistance(t,e,1,3)+this.getDistance(e,n,1,3)).toFixed(3)==this.getDistance(t,n,1,3)},isPointNearLine:function(e,t,n,i){return this.getDistanceFromLine(e,t,n)<i},getDistanceFromLine:function(e,t,n){var i=this.getDistance(t,e,1,3),r=this.getDistance(e,n,1,3),o=this.getDistance(t,n,1,3),s=Math.acos((i*i+o*o-r*r)/(2*i*o)),a=Math.acos((r*r+o*o-i*i)/(2*r*o));return s>Math.PI/2?i:a>Math.PI/2?r:Math.sin(s)*i},findNearest:function(e,t,n,i){n=n||0,i=i||1;var r=this.orderByDistance(e,t);return 1===i?r[n]:r.splice(n,i)},getPathLength:function(e){for(var t,n=0,i=0,r=e.length;i<r;++i)t&&(n+=this.getDistance(this.coords(e[i]),t)),t=this.coords(e[i]);return n},getSpeed:function(e,t,n){var i=n&&n.unit||"km";"mph"==i?i="mi":"kmh"==i&&(i="km");var o=r.getDistance(e,t),s=1*t.time/1e3-1*e.time/1e3,a=o/s*3600;return Math.round(a*this.measures[i]*1e4)/1e4},computeDestinationPoint:function(e,t,n,i){var r=this.latitude(e),o=this.longitude(e);i=void 0===i?this.radius:Number(i);var s=Number(t)/i,a=Number(n).toRad(),l=Number(r).toRad(),c=Number(o).toRad(),u=Math.asin(Math.sin(l)*Math.cos(s)+Math.cos(l)*Math.sin(s)*Math.cos(a)),h=c+Math.atan2(Math.sin(a)*Math.sin(s)*Math.cos(l),Math.cos(s)-Math.sin(l)*Math.sin(u));return h=(h+3*Math.PI)%(2*Math.PI)-Math.PI,{latitude:u.toDeg(),longitude:h.toDeg()}},convertUnit:function(e,t,n){if(0===t)return 0;if(void 0===t){if(null===this.distance)throw new Error("No distance was given");if(0===this.distance)return 0;t=this.distance}if(e=e||"m",n=null==n?4:n,void 0!==this.measures[e])return this.round(t*this.measures[e],n);throw new Error("Unknown unit for conversion.")},
useDecimal:function(e){if("[object Array]"===Object.prototype.toString.call(e)){var t=this;return e=e.map(function(e){if(t.isDecimal(e))return t.useDecimal(e);if("object"==typeof e){if(t.validate(e))return t.coords(e);for(var n in e)e[n]=t.useDecimal(e[n]);return e}return t.isSexagesimal(e)?t.sexagesimal2decimal(e):e})}if("object"==typeof e&&this.validate(e))return this.coords(e);if("object"==typeof e){for(var n in e)e[n]=this.useDecimal(e[n]);return e}if(this.isDecimal(e))return parseFloat(e);if(!0===this.isSexagesimal(e))return parseFloat(this.sexagesimal2decimal(e));throw new Error("Unknown format.")},decimal2sexagesimal:function(e){if(e in this.sexagesimal)return this.sexagesimal[e];var t=e.toString().split("."),n=Math.abs(t[0]),i=60*("0."+(t[1]||0)),r=i.toString().split(".");return i=Math.floor(i),r=(60*("0."+(r[1]||0))).toFixed(2),this.sexagesimal[e]=n+"° "+i+"' "+r+'"',this.sexagesimal[e]},sexagesimal2decimal:function(e){if(e in this.decimal)return this.decimal[e];var t=new RegExp(this.sexagesimalPattern),n=t.exec(e),i=0,r=0;n&&(i=parseFloat(n[2]/60),r=parseFloat(n[4]/3600)||0);var o=(parseFloat(n[1])+i+r).toFixed(8);return o="S"==n[7]||"W"==n[7]?parseFloat(-o):parseFloat(o),this.decimal[e]=o,o},isDecimal:function(e){return e=e.toString().replace(/\s*/,""),!isNaN(parseFloat(e))&&parseFloat(e)==e},isSexagesimal:function(e){return e=e.toString().replace(/\s*/,""),this.sexagesimalPattern.test(e)},round:function(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n}}),void 0!==t&&void 0!==t.exports?(t.exports=r,"object"==typeof e&&(e.geolib=r)):"function"==typeof define&&define.amd?define("geolib",[],function(){return r}):e.geolib=r}(this)},{}],19:[function(e,t,n){function i(e,t){t||(t={});var n="object"==typeof e?[e]:l(e);return c||(c=document.createElement("div")),o(u(t),function(e){var i=t[e];o(n,function(t){var n=t.parentNode;if(":first"===e)r(t,i);else if(/:first$/.test(e)){var o=e.replace(/:first$/,"");n&&n.removeChild(t),c.appendChild(t);var s=c.querySelector(o);c.removeChild(t),n&&n.appendChild(t),s&&r(s,i)}else{n&&n.removeChild(t),c.appendChild(t);var a=t.parentNode.querySelectorAll(e);if(c.removeChild(t),n&&n.appendChild(t),0===a.length)return;for(var l=0;l<a.length;l++)r(a[l],i)}})}),1===n.length?n[0]:n}function r(e,t){if(s(t))e.innerHTML="",e.appendChild(t);else if(h(t)){for(var n=0;n<t.length;n++){var r=i(e.cloneNode(!0),t[n]);e.parentNode.insertBefore(r,e)}e.parentNode.removeChild(e)}else t&&"object"==typeof t?o(u(t),function(n){if("_text"===n)a(e,t[n]);else if("_html"===n&&s(t[n]))e.innerHTML="",e.appendChild(t[n]);else if("_html"===n)e.innerHTML=t[n];else if(t[n]&&"object"==typeof t[n]){var i=t[n];i.append?e.setAttribute(n,e.getAttribute(n)+i.append):i.prepend&&e.setAttribute(n,i.prepend+e.getAttribute(n))}else e.setAttribute(n,t[n])}):a(e,t)}function o(e,t){if(e.forEach)return e.forEach(t);for(var n=0;n<e.length;n++)t(e[n],n)}function s(e){return e&&"object"==typeof e&&e.childNodes&&("function"==typeof e.appendChild||"object"==typeof e.appendChild)}function a(e,t){e.innerHTML="";var n=document.createTextNode(String(t));e.appendChild(n)}var l=e("domify");t.exports=i;var c=null,u=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t},h=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{domify:16}],20:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],21:[function(e,t,n){(function(t){"use strict";var i=e("events"),r={1:"Position tracking not allowed",2:"Position tracking unavailable",3:"Position tracking timeout",DEFAULT:"Position tracking error"};n.create=function(){function e(e){a.emit("position",{latitude:e.coords.latitude,longitude:e.coords.longitude,accuracy:e.coords.accuracy})}function n(e){var t=new Error(r[e.code]||r.DEFAULT);t.code=e.code,a.emit("error",t)}function o(e){var t;if(void 0!==e.webkitCompassHeading){if("number"!=typeof(t=e.webkitCompassHeading))return;t=Math.floor(t)}else{if("number"!=typeof e.alpha)return;t=360-Math.floor(e.alpha)}t!==s&&(s=t,a.emit("heading",t))}var s,a=new i.EventEmitter,l=navigator.geolocation.watchPosition(e,n,{enableHighAccuracy:!0,maximumAge:0});return t.addEventListener("deviceorientation",o,!1),a.destroy=function(){t.removeEventListener("deviceorientation",o),a.removeAllListeners(),navigator.geolocation.clearWatch(l)},a}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{events:17}],22:[function(e,t,n){(function(e){!function(e){"use strict";function i(e){this.tokens=[],this.tokens.links={},this.options=e||f.defaults,this.rules=g.normal,this.options.gfm&&(this.options.tables?this.rules=g.tables:this.rules=g.gfm)}function r(e,t){if(this.options=t||f.defaults,this.links=e,this.rules=m.normal,this.renderer=this.options.renderer||new o,this.renderer.options=this.options,!this.links)throw new Error("Tokens array requires a `links` property.");this.options.gfm?this.options.breaks?this.rules=m.breaks:this.rules=m.gfm:this.options.pedantic&&(this.rules=m.pedantic)}function o(e){this.options=e||{}}function s(){}function a(e){this.tokens=[],this.token=null,this.options=e||f.defaults,this.options.renderer=this.options.renderer||new o,this.renderer=this.options.renderer,this.renderer.options=this.options}function l(e,t){return e.replace(t?/&/g:/&(?!#?\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function c(e){return e.replace(/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/gi,function(e,t){return t=t.toLowerCase(),"colon"===t?":":"#"===t.charAt(0)?"x"===t.charAt(1)?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):""})}function u(e,t){return e=e.source,t=t||"",{replace:function(t,n){return n=n.source||n,n=n.replace(/(^|[^\[])\^/g,"$1"),e=e.replace(t,n),this},getRegex:function(){return new RegExp(e,t)}}}function h(e,t){return v[" "+e]||(/^[^:]+:\/*[^\/]*$/.test(e)?v[" "+e]=e+"/":v[" "+e]=e.replace(/[^\/]*$/,"")),e=v[" "+e],"//"===t.slice(0,2)?e.replace(/:[\s\S]*/,":")+t:"/"===t.charAt(0)?e.replace(/(:\/*[^\/]*)[\s\S]*/,"$1")+t:e+t}function d(){}function p(e){for(var t,n,i=1;i<arguments.length;i++){t=arguments[i];for(n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}function f(e,t,n){if(void 0===e||null===e)throw new Error("marked(): input parameter is undefined or null");if("string"!=typeof e)throw new Error("marked(): input parameter is of type "+Object.prototype.toString.call(e)+", string expected");if(n||"function"==typeof t){n||(n=t,t=null),t=p({},f.defaults,t||{});var r,o,s=t.highlight,c=0;try{r=i.lex(e,t)}catch(e){return n(e)}o=r.length;var u=function(e){if(e)return t.highlight=s,n(e);var i;try{i=a.parse(r,t)}catch(t){e=t}return t.highlight=s,e?n(e):n(null,i)};if(!s||s.length<3)return u();if(delete t.highlight,!o)return u();for(;c<r.length;c++)!function(e){"code"!==e.type?--o||u():s(e.text,e.lang,function(t,n){return t?u(t):null==n||n===e.text?--o||u():(e.text=n,e.escaped=!0,void(--o||u()))})}(r[c])}else try{return t&&(t=p({},f.defaults,t)),a.parse(i.lex(e,t),t)}catch(e){if(e.message+="\nPlease report this to https://github.com/markedjs/marked.",(t||f.defaults).silent)return"<p>An error occurred:</p><pre>"+l(e.message+"",!0)+"</pre>";throw e}}var g={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:d,hr:/^ {0,3}((?:- *){3,}|(?:_ *){3,}|(?:\* *){3,})(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/,nptable:d,blockquote:/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/,list:/^( *)(bull) [\s\S]+?(?:hr|def|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,html:/^ *(?:comment *(?:\n|\s*$)|closed *(?:\n{2,}|\s*$)|closing *(?:\n{2,}|\s*$))/,def:/^ {0,3}\[(label)\]: *\n? *<?([^\s>]+)>?(?:(?: +\n? *| *\n *)(title))? *(?:\n+|$)/,table:d,lheading:/^([^\n]+)\n *(=|-){2,} *(?:\n+|$)/,paragraph:/^([^\n]+(?:\n?(?!hr|heading|lheading| {0,3}>|tag)[^\n]+)+)/,text:/^[^\n]+/};g._label=/(?:\\[\[\]]|[^\[\]])+/,g._title=/(?:"(?:\\"|[^"]|"[^"\n]*")*"|'\n?(?:[^'\n]+\n?)*'|\([^()]*\))/,g.def=u(g.def).replace("label",g._label).replace("title",g._title).getRegex(),g.bullet=/(?:[*+-]|\d+\.)/,g.item=/^( *)(bull) [^\n]*(?:\n(?!\1bull )[^\n]*)*/,g.item=u(g.item,"gm").replace(/bull/g,g.bullet).getRegex(),g.list=u(g.list).replace(/bull/g,g.bullet).replace("hr","\\n+(?=\\1?(?:(?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$))").replace("def","\\n+(?="+g.def.source+")").getRegex(),g._tag="(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b",g.html=u(g.html).replace("comment",/<!--[\s\S]*?-->/).replace("closed",/<(tag)[\s\S]+?<\/\1>/).replace("closing",/<tag(?:"[^"]*"|'[^']*'|\s[^'"\/>\s]*)*?\/?>/).replace(/tag/g,g._tag).getRegex(),g.paragraph=u(g.paragraph).replace("hr",g.hr).replace("heading",g.heading).replace("lheading",g.lheading).replace("tag","<"+g._tag).getRegex(),g.blockquote=u(g.blockquote).replace("paragraph",g.paragraph).getRegex(),g.normal=p({},g),g.gfm=p({},g.normal,{fences:/^ *(`{3,}|~{3,})[ \.]*(\S+)? *\n([\s\S]*?)\n? *\1 *(?:\n+|$)/,paragraph:/^/,heading:/^ *(#{1,6}) +([^\n]+?) *#* *(?:\n+|$)/}),g.gfm.paragraph=u(g.paragraph).replace("(?!","(?!"+g.gfm.fences.source.replace("\\1","\\2")+"|"+g.list.source.replace("\\1","\\3")+"|").getRegex(),g.tables=p({},g.gfm,{nptable:/^ *(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)\n*/,table:/^ *\|(.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)\n*/}),i.rules=g,i.lex=function(e,t){return new i(t).lex(e)},i.prototype.lex=function(e){return e=e.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    ").replace(/\u00a0/g," ").replace(/\u2424/g,"\n"),this.token(e,!0)},i.prototype.token=function(e,t){e=e.replace(/^ +$/gm,"");for(var n,i,r,o,s,a,l,c,u,h,d;e;)if((r=this.rules.newline.exec(e))&&(e=e.substring(r[0].length),r[0].length>1&&this.tokens.push({type:"space"})),r=this.rules.code.exec(e))e=e.substring(r[0].length),r=r[0].replace(/^ {4}/gm,""),this.tokens.push({type:"code",text:this.options.pedantic?r:r.replace(/\n+$/,"")});else if(r=this.rules.fences.exec(e))e=e.substring(r[0].length),this.tokens.push({type:"code",lang:r[2],text:r[3]||""});else if(r=this.rules.heading.exec(e))e=e.substring(r[0].length),this.tokens.push({type:"heading",depth:r[1].length,text:r[2]});else if(t&&(r=this.rules.nptable.exec(e))){for(e=e.substring(r[0].length),a={type:"table",header:r[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:r[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:r[3].replace(/\n$/,"").split("\n")},c=0;c<a.align.length;c++)/^ *-+: *$/.test(a.align[c])?a.align[c]="right":/^ *:-+: *$/.test(a.align[c])?a.align[c]="center":/^ *:-+ *$/.test(a.align[c])?a.align[c]="left":a.align[c]=null;for(c=0;c<a.cells.length;c++)a.cells[c]=a.cells[c].split(/ *\| */);this.tokens.push(a)}else if(r=this.rules.hr.exec(e))e=e.substring(r[0].length),this.tokens.push({type:"hr"});else if(r=this.rules.blockquote.exec(e))e=e.substring(r[0].length),this.tokens.push({type:"blockquote_start"}),r=r[0].replace(/^ *> ?/gm,""),this.token(r,t),this.tokens.push({type:"blockquote_end"});else if(r=this.rules.list.exec(e)){for(e=e.substring(r[0].length),o=r[2],d=o.length>1,this.tokens.push({type:"list_start",ordered:d,start:d?+o:""}),r=r[0].match(this.rules.item),n=!1,h=r.length,c=0;c<h;c++)a=r[c],l=a.length,a=a.replace(/^ *([*+-]|\d+\.) +/,""),~a.indexOf("\n ")&&(l-=a.length,a=this.options.pedantic?a.replace(/^ {1,4}/gm,""):a.replace(new RegExp("^ {1,"+l+"}","gm"),"")),this.options.smartLists&&c!==h-1&&(s=g.bullet.exec(r[c+1])[0],o===s||o.length>1&&s.length>1||(e=r.slice(c+1).join("\n")+e,c=h-1)),i=n||/\n\n(?!\s*$)/.test(a),c!==h-1&&(n="\n"===a.charAt(a.length-1),i||(i=n)),this.tokens.push({type:i?"loose_item_start":"list_item_start"}),this.token(a,!1),this.tokens.push({type:"list_item_end"});this.tokens.push({type:"list_end"})}else if(r=this.rules.html.exec(e))e=e.substring(r[0].length),this.tokens.push({type:this.options.sanitize?"paragraph":"html",pre:!this.options.sanitizer&&("pre"===r[1]||"script"===r[1]||"style"===r[1]),text:r[0]});else if(t&&(r=this.rules.def.exec(e)))e=e.substring(r[0].length),r[3]&&(r[3]=r[3].substring(1,r[3].length-1)),u=r[1].toLowerCase(),this.tokens.links[u]||(this.tokens.links[u]={href:r[2],title:r[3]});else if(t&&(r=this.rules.table.exec(e))){for(e=e.substring(r[0].length),a={type:"table",header:r[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:r[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:r[3].replace(/(?: *\| *)?\n$/,"").split("\n")},c=0;c<a.align.length;c++)/^ *-+: *$/.test(a.align[c])?a.align[c]="right":/^ *:-+: *$/.test(a.align[c])?a.align[c]="center":/^ *:-+ *$/.test(a.align[c])?a.align[c]="left":a.align[c]=null;for(c=0;c<a.cells.length;c++)a.cells[c]=a.cells[c].replace(/^ *\| *| *\| *$/g,"").split(/ *\| */);this.tokens.push(a)}else if(r=this.rules.lheading.exec(e))e=e.substring(r[0].length),this.tokens.push({type:"heading",depth:"="===r[2]?1:2,text:r[1]});else if(t&&(r=this.rules.paragraph.exec(e)))e=e.substring(r[0].length),this.tokens.push({type:"paragraph",text:"\n"===r[1].charAt(r[1].length-1)?r[1].slice(0,-1):r[1]});else if(r=this.rules.text.exec(e))e=e.substring(r[0].length),this.tokens.push({type:"text",text:r[0]});else if(e)throw new Error("Infinite loop on byte: "+e.charCodeAt(0));return this.tokens};var m={escape:/^\\([\\`*{}\[\]()#+\-.!_>])/,autolink:/^<(scheme:[^\s\x00-\x1f<>]*|email)>/,url:d,tag:/^<!--[\s\S]*?-->|^<\/?[a-zA-Z0-9\-]+(?:"[^"]*"|'[^']*'|\s[^<'">\/\s]*)*?\/?>/,link:/^!?\[(inside)\]\(href\)/,reflink:/^!?\[(inside)\]\s*\[([^\]]*)\]/,nolink:/^!?\[((?:\[[^\[\]]*\]|\\[\[\]]|[^\[\]])*)\]/,strong:/^__([\s\S]+?)__(?!_)|^\*\*([\s\S]+?)\*\*(?!\*)/,em:/^_([^\s_](?:[^_]|__)+?[^\s_])_\b|^\*((?:\*\*|[^*])+?)\*(?!\*)/,code:/^(`+)\s*([\s\S]*?[^`]?)\s*\1(?!`)/,br:/^ {2,}\n(?!\s*$)/,del:d,text:/^[\s\S]+?(?=[\\<!\[`*]|\b_| {2,}\n|$)/};m._scheme=/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/,m._email=/[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/,m.autolink=u(m.autolink).replace("scheme",m._scheme).replace("email",m._email).getRegex(),m._inside=/(?:\[[^\[\]]*\]|\\[\[\]]|[^\[\]]|\](?=[^\[]*\]))*/,m._href=/\s*<?([\s\S]*?)>?(?:\s+['"]([\s\S]*?)['"])?\s*/,m.link=u(m.link).replace("inside",m._inside).replace("href",m._href).getRegex(),m.reflink=u(m.reflink).replace("inside",m._inside).getRegex(),m.normal=p({},m),m.pedantic=p({},m.normal,{strong:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,em:/^_(?=\S)([\s\S]*?\S)_(?!_)|^\*(?=\S)([\s\S]*?\S)\*(?!\*)/}),m.gfm=p({},m.normal,{escape:u(m.escape).replace("])","~|])").getRegex(),url:u(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/).replace("email",m._email).getRegex(),_backpedal:/(?:[^?!.,:;*_~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_~)]+(?!$))+/,del:/^~~(?=\S)([\s\S]*?\S)~~/,text:u(m.text).replace("]|","~]|").replace("|","|https?://|ftp://|www\\.|[a-zA-Z0-9.!#$%&'*+/=?^_`{\\|}~-]+@|").getRegex()}),m.breaks=p({},m.gfm,{br:u(m.br).replace("{2,}","*").getRegex(),text:u(m.gfm.text).replace("{2,}","*").getRegex()}),r.rules=m,r.output=function(e,t,n){return new r(t,n).output(e)},r.prototype.output=function(e){for(var t,n,i,r,o="";e;)if(r=this.rules.escape.exec(e))e=e.substring(r[0].length),o+=r[1];else if(r=this.rules.autolink.exec(e))e=e.substring(r[0].length),"@"===r[2]?(n=l(this.mangle(r[1])),i="mailto:"+n):(n=l(r[1]),i=n),o+=this.renderer.link(i,null,n);else if(this.inLink||!(r=this.rules.url.exec(e))){if(r=this.rules.tag.exec(e))!this.inLink&&/^<a /i.test(r[0])?this.inLink=!0:this.inLink&&/^<\/a>/i.test(r[0])&&(this.inLink=!1),e=e.substring(r[0].length),o+=this.options.sanitize?this.options.sanitizer?this.options.sanitizer(r[0]):l(r[0]):r[0];else if(r=this.rules.link.exec(e))e=e.substring(r[0].length),this.inLink=!0,o+=this.outputLink(r,{href:r[2],title:r[3]}),this.inLink=!1;else if((r=this.rules.reflink.exec(e))||(r=this.rules.nolink.exec(e))){if(e=e.substring(r[0].length),t=(r[2]||r[1]).replace(/\s+/g," "),!(t=this.links[t.toLowerCase()])||!t.href){o+=r[0].charAt(0),e=r[0].substring(1)+e;continue}this.inLink=!0,o+=this.outputLink(r,t),this.inLink=!1}else if(r=this.rules.strong.exec(e))e=e.substring(r[0].length),o+=this.renderer.strong(this.output(r[2]||r[1]));else if(r=this.rules.em.exec(e))e=e.substring(r[0].length),o+=this.renderer.em(this.output(r[2]||r[1]));else if(r=this.rules.code.exec(e))e=e.substring(r[0].length),o+=this.renderer.codespan(l(r[2].trim(),!0));else if(r=this.rules.br.exec(e))e=e.substring(r[0].length),o+=this.renderer.br();else if(r=this.rules.del.exec(e))e=e.substring(r[0].length),o+=this.renderer.del(this.output(r[1]));else if(r=this.rules.text.exec(e))e=e.substring(r[0].length),o+=this.renderer.text(l(this.smartypants(r[0])));else if(e)throw new Error("Infinite loop on byte: "+e.charCodeAt(0))}else r[0]=this.rules._backpedal.exec(r[0])[0],e=e.substring(r[0].length),"@"===r[2]?(n=l(r[0]),i="mailto:"+n):(n=l(r[0]),i="www."===r[1]?"http://"+n:n),o+=this.renderer.link(i,null,n);return o},r.prototype.outputLink=function(e,t){var n=l(t.href),i=t.title?l(t.title):null;return"!"!==e[0].charAt(0)?this.renderer.link(n,i,this.output(e[1])):this.renderer.image(n,i,l(e[1]))},r.prototype.smartypants=function(e){return this.options.smartypants?e.replace(/---/g,"—").replace(/--/g,"–").replace(/(^|[-\u2014\/(\[{"\s])'/g,"$1‘").replace(/'/g,"’").replace(/(^|[-\u2014\/(\[{\u2018\s])"/g,"$1“").replace(/"/g,"”").replace(/\.{3}/g,"…"):e},r.prototype.mangle=function(e){if(!this.options.mangle)return e;for(var t,n="",i=e.length,r=0;r<i;r++)t=e.charCodeAt(r),Math.random()>.5&&(t="x"+t.toString(16)),n+="&#"+t+";";return n},o.prototype.code=function(e,t,n){if(this.options.highlight){var i=this.options.highlight(e,t);null!=i&&i!==e&&(n=!0,e=i)}return t?'<pre><code class="'+this.options.langPrefix+l(t,!0)+'">'+(n?e:l(e,!0))+"\n</code></pre>\n":"<pre><code>"+(n?e:l(e,!0))+"\n</code></pre>"},o.prototype.blockquote=function(e){return"<blockquote>\n"+e+"</blockquote>\n"},o.prototype.html=function(e){return e},o.prototype.heading=function(e,t,n){return"<h"+t+' id="'+this.options.headerPrefix+n.toLowerCase().replace(/[^\w]+/g,"-")+'">'+e+"</h"+t+">\n"},o.prototype.hr=function(){return this.options.xhtml?"<hr/>\n":"<hr>\n"},o.prototype.list=function(e,t,n){var i=t?"ol":"ul";return"<"+i+(t&&1!==n?' start="'+n+'"':"")+">\n"+e+"</"+i+">\n"},o.prototype.listitem=function(e){return"<li>"+e+"</li>\n"},o.prototype.paragraph=function(e){return"<p>"+e+"</p>\n"},o.prototype.table=function(e,t){return"<table>\n<thead>\n"+e+"</thead>\n<tbody>\n"+t+"</tbody>\n</table>\n"},o.prototype.tablerow=function(e){return"<tr>\n"+e+"</tr>\n"},o.prototype.tablecell=function(e,t){var n=t.header?"th":"td";return(t.align?"<"+n+' style="text-align:'+t.align+'">':"<"+n+">")+e+"</"+n+">\n"},o.prototype.strong=function(e){return"<strong>"+e+"</strong>"},o.prototype.em=function(e){return"<em>"+e+"</em>"},o.prototype.codespan=function(e){return"<code>"+e+"</code>"},o.prototype.br=function(){return this.options.xhtml?"<br/>":"<br>"},o.prototype.del=function(e){return"<del>"+e+"</del>"},o.prototype.link=function(e,t,n){if(this.options.sanitize){try{var i=decodeURIComponent(c(e)).replace(/[^\w:]/g,"").toLowerCase()}catch(e){return n}if(0===i.indexOf("javascript:")||0===i.indexOf("vbscript:")||0===i.indexOf("data:"))return n}this.options.baseUrl&&!y.test(e)&&(e=h(this.options.baseUrl,e));var r='<a href="'+e+'"';return t&&(r+=' title="'+t+'"'),r+=">"+n+"</a>"},o.prototype.image=function(e,t,n){this.options.baseUrl&&!y.test(e)&&(e=h(this.options.baseUrl,e));var i='<img src="'+e+'" alt="'+n+'"';return t&&(i+=' title="'+t+'"'),i+=this.options.xhtml?"/>":">"},o.prototype.text=function(e){return e},s.prototype.strong=s.prototype.em=s.prototype.codespan=s.prototype.del=s.prototype.text=function(e){return e},s.prototype.link=s.prototype.image=function(e,t,n){return""+n},s.prototype.br=function(){return""},a.parse=function(e,t){return new a(t).parse(e)},a.prototype.parse=function(e){this.inline=new r(e.links,this.options),this.inlineText=new r(e.links,p({},this.options,{renderer:new s})),this.tokens=e.reverse();for(var t="";this.next();)t+=this.tok();return t},a.prototype.next=function(){return this.token=this.tokens.pop()},a.prototype.peek=function(){return this.tokens[this.tokens.length-1]||0},a.prototype.parseText=function(){for(var e=this.token.text;"text"===this.peek().type;)e+="\n"+this.next().text;return this.inline.output(e)},a.prototype.tok=function(){switch(this.token.type){case"space":return"";case"hr":return this.renderer.hr();case"heading":return this.renderer.heading(this.inline.output(this.token.text),this.token.depth,c(this.inlineText.output(this.token.text)));case"code":return this.renderer.code(this.token.text,this.token.lang,this.token.escaped);case"table":var e,t,n,i,r="",o="";for(n="",e=0;e<this.token.header.length;e++)n+=this.renderer.tablecell(this.inline.output(this.token.header[e]),{header:!0,align:this.token.align[e]});for(r+=this.renderer.tablerow(n),e=0;e<this.token.cells.length;e++){for(t=this.token.cells[e],n="",i=0;i<t.length;i++)n+=this.renderer.tablecell(this.inline.output(t[i]),{header:!1,align:this.token.align[i]});o+=this.renderer.tablerow(n)}return this.renderer.table(r,o);case"blockquote_start":for(o="";"blockquote_end"!==this.next().type;)o+=this.tok();return this.renderer.blockquote(o);case"list_start":o="";for(var s=this.token.ordered,a=this.token.start;"list_end"!==this.next().type;)o+=this.tok();return this.renderer.list(o,s,a);case"list_item_start":for(o="";"list_item_end"!==this.next().type;)o+="text"===this.token.type?this.parseText():this.tok();return this.renderer.listitem(o);case"loose_item_start":for(o="";"list_item_end"!==this.next().type;)o+=this.tok();return this.renderer.listitem(o);case"html":var l=this.token.pre||this.options.pedantic?this.token.text:this.inline.output(this.token.text);return this.renderer.html(l);case"paragraph":return this.renderer.paragraph(this.inline.output(this.token.text));case"text":return this.renderer.paragraph(this.parseText())}};var v={},y=/^$|^[a-z][a-z0-9+.-]*:|^[?#]/i;d.exec=d,f.options=f.setOptions=function(e){return p(f.defaults,e),f},f.defaults={gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!1,sanitizer:null,mangle:!0,smartLists:!1,silent:!1,highlight:null,langPrefix:"lang-",smartypants:!1,headerPrefix:"",renderer:new o,xhtml:!1,baseUrl:null},f.Parser=a,f.parser=a.parse,f.Renderer=o,f.TextRenderer=s,f.Lexer=i,f.lexer=i.lex,f.InlineLexer=r,f.inlineLexer=r.output,f.parse=f,void 0!==t&&"object"==typeof n?t.exports=f:"function"==typeof define&&define.amd?define(function(){return f}):e.marked=f}(this||("undefined"!=typeof window?window:e))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],23:[function(e,t,n){"use strict";function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.exports=function(e,t,n,o){t=t||"&",n=n||"=";var s={};if("string"!=typeof e||0===e.length)return s;var a=/\+/g;e=e.split(t);var l=1e3;o&&"number"==typeof o.maxKeys&&(l=o.maxKeys);var c=e.length;l>0&&c>l&&(c=l);for(var u=0;u<c;++u){var h,d,p,f,g=e[u].replace(a,"%20"),m=g.indexOf(n);m>=0?(h=g.substr(0,m),d=g.substr(m+1)):(h=g,d=""),p=decodeURIComponent(h),f=decodeURIComponent(d),i(s,p)?r(s[p])?s[p].push(f):s[p]=[s[p],f]:s[p]=f}return s};var r=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{}],24:[function(e,t,n){"use strict";function i(e,t){if(e.map)return e.map(t);for(var n=[],i=0;i<e.length;i++)n.push(t(e[i],i));return n}var r=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};t.exports=function(e,t,n,a){return t=t||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?i(s(e),function(s){var a=encodeURIComponent(r(s))+n;return o(e[s])?i(e[s],function(e){return a+encodeURIComponent(r(e))}).join(t):a+encodeURIComponent(r(e[s]))}).join(t):a?encodeURIComponent(r(a))+n+encodeURIComponent(r(e)):""};var o=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},s=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}},{}],25:[function(e,t,n){"use strict";n.decode=n.parse=e("./decode"),n.encode=n.stringify=e("./encode")},{"./decode":23,"./encode":24}],26:[function(e,t,n){"use strict";var i=e("querystring"),r=e("./content-manager"),o=e("./screen-default");document.addEventListener("DOMContentLoaded",function(){var e=document.body.querySelector("#content"),t=i.parse(location.search.substring(1));if(t.story){r.create(e).load(t.story)}else o.create(e)})},{"./content-manager":2,"./screen-default":5,querystring:25}]},{},[26]);