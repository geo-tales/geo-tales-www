!function e(t,n,i){function r(s,a){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[s]={exports:{}};t[s][0].call(c.exports,function(e){var n=t[s][1][e];return r(n?n:e)},c,c.exports,e,t,n,i)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(e,t,n){"use strict";function i(e){var t=Math.min(Math.floor(3*e*255),255).toString(16);return 1===t.length?"0"+t:t}t.exports=function(e){var t;return function(n){t||(t=n);var r,o=(n-n%e)/t;return r=o>1?o>1.33?"0000ff":"00"+i(1.33-o)+"ff":.33>=o?"ff"+i(o)+"00":.66>=o?i(.66-o)+"ff00":"00ff"+i(o-.66),"#"+r}}},{}],2:[function(e,t,n){"use strict";var i=e("./story"),r=e("./screen-text"),o=e("./screen-restore");n.create=function(e){function t(t){e.innerHTML="";var n=new XMLHttpRequest;n.onload=function(){if(200===this.status)try{var n=i.fromJson(JSON.parse(this.responseText));n(e),"tour.json"!==t&&localStorage.setItem("story",t)}catch(o){r.create(e,"## Failed to load story!\n\n"+t+"\n\n```"+o.toString()+"\n```")}else r.create(e,"## "+this.status+"\n\n"+t)},n.open("get",t,!0),n.send()}return{load:function(n){function i(){localStorage.clear(),t(n)}var r=localStorage.getItem("story");r&&localStorage.getItem("screen")?o.create(e,function(){t(r)},i):i()}}}},{"./screen-restore":10,"./screen-text":12,"./story":14}],3:[function(e,t,n){"use strict";function i(e){this.center=e}function r(e,t){i.call(this,e),this.radius=t}function o(e){i.call(this,s.getCenter(e)),this.coords=e}var s=e("geolib"),a=e("inherits");i.prototype.distance=function(e){return s.getDistance(this.center,e)},n.Shape=i,a(r,i),r.prototype.within=function(e){return this.distance(e)<=this.radius},n.Circle=r,a(o,i),o.prototype.within=function(e){return s.isPointInside(e,this.coords)},n.Polygon=o,n.fromJson=function(e){if("circle"===e.type)return new r(e.center,e.radius);if("polygon"===e.type)return new o(e.coords);throw new Error("Unkown type: "+e.type)}},{geolib:18,inherits:20}],4:[function(e,t,n){"use strict";var i=e("animatify");n.create=function(e,t,n,r){var o=document.createElement("div");return o.innerHTML=t,o.classList.add("message",n),e.appendChild(o),i(o,"bounceInDown",function(){o.classList.add("animated","infinite","pulse"),r&&r()}),{destroy:function(t){o.classList.remove("animated","infinite","pulse"),i(o,"bounceOutUp",function(){e.removeChild(o),t&&t()})}}}},{animatify:15}],5:[function(e,t,n){"use strict";var i=e("hyperglue"),r=e("marked"),o=e("./screen"),s='<div class="screen">\n  <div class="text"></div>\n  <form class="story" action="">\n    <input type="text" name="story" placeholder="Paste story URL here" autocomplete="off"/>\n  </form>\n</div>\n',a="## Location based stories\n\nGeo Tales lets you create and play interactive, location based stories.\n\nStories can be created by anybody and hosted for free on GitHub. Please see\nthe [Geo Tales project page][project] for details on how to build stories.\n\nTo play a story, enter the gist URL below, or check out the [screens tour][].\n\n[project]: https://github.com/geo-tales/geo-tales-mobile/blob/master/README.md\n[screens tour]: ?story=tour.json\n";n.create=function(e){var t=i(s,{".text":{_html:r(a)}});e.appendChild(t),o.show([t.querySelector(".text"),t.querySelector("form")])}},{"./screen":13,hyperglue:19,marked:22}],6:[function(e,t,n){"use strict";function i(e){return 10>e?"0"+e:e}function r(e){var t=[],n=Math.floor(e/36e5);e-=36e5*n;var r=Math.floor(e/6e4);e-=6e4*r;var o=Math.floor(e/1e3);return t.push(n,i(r),i(o)),t.join(":")}var o=e("hyperglue"),s=e("marked"),a=e("./screen"),l='<div class="screen">\n  <div class="text"></div>\n  <div class="results">\n    <ul>\n      <li class="result">\n        <span class="name">&nbsp;</span>\n        <span class="value">&nbsp;</span>\n      </li>\n    </ul>\n  </div>\n  <div class="footer">\n    <button class="close">Close</button>\n  </div>\n</div>\n';n.create=function(e,t,n,i){var u=[];n.time&&u.push({".name":"Time:",".value":r(n.time)}),"number"==typeof n.points&&u.push({".name":"Points:",".value":String(n.points)});var c=o(l,{".text":{_html:s(t||"## Congratulations!\n\nYou reached the end of this story.")},".result":u});e.appendChild(c);var h=c.querySelector(".footer"),d=[c.querySelector(".text"),c.querySelector(".results"),h];h.querySelector(".close").onclick=function(){a.hide(d,i)},a.show(d)}},{"./screen":13,hyperglue:19,marked:22}],7:[function(e,t,n){"use strict";var i=e("hyperglue"),r=e("marked"),o=e("animatify"),s=e("./screen"),a='<div class="screen">\n  <div class="text"></div>\n  <form action="#" onsubmit="return false;">\n    <input name="answer" autocomplete="off"/>\n  </form>\n  <div class="footer">\n    <button class="next">&#8594;</button>\n  </div>\n</div>\n';n.create=function(e,t,n,l){function u(){g.push(f),s.hide(g,l)}var c=i(a,{".text":{_html:r(t)}}),h=c.querySelector(".text"),d=c.querySelector("form"),f=c.querySelector(".footer"),p=d.querySelector("input[name=answer]");p.type="number"==typeof n.answer?"number":"text",f.style.display="none";var g=[h,d],m=String(n.answer).toLowerCase(),v=!1;p.onchange=function(){v||(p.value.trim().toLowerCase()===m?(p.blur(),p.classList.remove("incorrect"),p.classList.add("correct"),v=!0,f.style.display="block",o(p,"tada",{delay:".5s"}),o(f,"bounceInUp",{delay:"1s"}),f.querySelector(".next").onclick=u):(p.classList.add("incorrect"),o(p,"shake",{duration:".7s"})))},p.onkeydown=function(){p.classList.remove("incorrect")},e.appendChild(c),s.show(g)}},{"./screen":13,animatify:15,hyperglue:19,marked:22}],8:[function(e,t,n){"use strict";var i=e("hyperglue"),r=e("marked"),o=e("animatify"),s=e("./screen"),a='<div class="screen">\n  <div class="text"></div>\n  <form action="#">\n    <ul>\n      <li class="choice">\n        <label>\n          <input type="radio" name="choice">\n          <span class="label">&nbsp;</span>\n        </label>\n      </li>\n    </ul>\n  </form>\n  <div class="footer">\n    <button class="next">&#8594;</button>\n  </div>\n</div>\n';n.create=function(e,t,n,l){function u(){var e=f.querySelector("input[name=choice]:checked");e&&(g.push(p),s.hide(g,function(){l(n[e.value])}))}var c=n.map(function(e,t){return{".label":{_html:r(e.text).trim().replace(/^<p>|<\/p>$/g,"")},input:{value:String(t)}}}),h=i(a,{".text":{_html:r(t)},".choice":c}),d=h.querySelector(".text"),f=h.querySelector("form"),p=h.querySelector(".footer");p.style.display="none";var g=[d,f],m=!1;Array.prototype.slice.call(f.querySelectorAll("input")).forEach(function(e){e.onchange=function(){m||(m=!0,p.style.display="block",o(p,"bounceInUp"),p.querySelector(".next").onclick=u)}}),e.appendChild(h),s.show(g)}},{"./screen":13,animatify:15,hyperglue:19,marked:22}],9:[function(e,t,n){"use strict";var i=e("events"),r=e("hyperglue"),o=e("animatify"),s=e("locatify"),a=e("./color"),l=e("./message"),u=e("./screen"),c='<div class="screen">\n  <div class="compass">\n    <div class="arrow">&#10143;</div>\n  </div>\n  <div class="distance"></div>\n  <div class="accuracy"></div>\n  <div class="footer">\n    <button class="next">&#8594;</button>\n  </div>\n</div>\n';n.create=function(e,t,n,h){function d(){S&&(S.destroy(),S=null)}function f(){k=M.latitude,w=M.longitude;var e=q-w,t=Math.cos(k)*Math.sin(C)-Math.sin(k)*Math.cos(C)*Math.cos(e),n=Math.sin(e)*Math.cos(C),i=180*Math.atan2(t,n)/Math.PI-L+180;0>i&&(i+=360);var r="rotate("+Math.round(i)+"deg)";v.style.transform=r,v.style.webkitTransform=r,T||(T=!0,I=!0,v.style.visibility="visible",o(v,"zoomIn",function(){I=!1,f()}))}function p(){var e=M.accuracy,t=20>e?"":"Accuracy: ";y.innerHTML=t+Math.round(e||1e4)+" m"}var g=r(c,{}),m=g.querySelector(".compass"),v=g.querySelector(".arrow"),y=g.querySelector(".accuracy"),b=g.querySelector(".distance"),x=g.querySelector(".footer");x.style.display="none",n.compass===!1&&(m.style.display="none"),e.appendChild(g);var k,w,L,M,S,_,E,C=t.center.latitude,q=t.center.longitude,T=!1,I=!1;n.demo?(_=new i.EventEmitter,_.destroy=function(){_.removeAllListeners()}):(_=s.create(e),E=setTimeout(function(){S||(d(),S=l.create(e,"Waiting for position data","info"))},3e3));var A=n.colorSteps?a(n.colorSteps):null;if(_.on("error",function(t){clearTimeout(E),d(),S=l.create(e,t.message,"warning"),T=!1,v.style.visibility="hidden",document.documentElement.style.backgroundColor="inherit"}),_.on("position",function(i){if(clearTimeout(E),d(),M=i,!I){var r=t.distance(i);n.distance!==!1&&(b.innerHTML=r+" m",p()),void 0!==L&&f();var o=i.accuracy&&i.accuracy<20;if(o?y.classList.contains("bad")&&(y.classList.remove("bad"),n.distance===!1&&(y.innerHTML="")):(y.classList.add("bad"),n.distance===!1&&p()),A&&(document.documentElement.style.backgroundColor=o?A(r):"inherit"),o&&t.within(i)){S&&(S.destroy(),S=null),_.destroy();var s=[];n.compass!==!1&&s.push(m),n.distance!==!1&&s.push(b,y),u.hide(s,function(){m.style.display="none",b.style.display="none",y.style.display="none"}),x.style.display="block",u.show([x]),setTimeout(function(){var t=l.create(e,"Location reached!","info",function(){x.querySelector(".next").onclick=function(){u.hide([x],function(){x.style.display="none"}),t.destroy(function(){document.documentElement.style.backgroundColor="inherit",h()})}})},500)}}}),n.compass!==!1&&_.on("heading",function(e){e&&(L=e,M&&!I&&f())}),n.demo){var D={latitude:t.center.latitude-5e-4,longitude:t.center.longitude,accuracy:5},P=360;_.emit("heading",P),_.emit("position",D);var R=function(){setTimeout(function(){_.emit("heading",P),P-=3,_.emit("position",D),D.latitude+=2e-5,D.latitude<t.center.latitude&&R()},50)};setTimeout(R,1e3)}}},{"./color":1,"./message":4,"./screen":13,animatify:15,events:17,hyperglue:19,locatify:21}],10:[function(e,t,n){"use strict";var i=e("hyperglue"),r=e("./screen"),o='<div class="screen">\n  <div class="text">\n    <h2>Continue last story?</h2>\n    <p>Do you want to continue playing the last story?</p>\n  </div>\n  <div class="footer">\n    <button class="continue">Continue</button>\n    <button class="discard">Discard</button>\n  </div>\n</div>\n';n.create=function(e,t,n){var s=i(o,{});e.appendChild(s);var a=s.querySelector(".footer"),l=[s.querySelector(".text"),a];a.querySelector(".continue").onclick=function(){r.hide(l,t)},a.querySelector(".discard").onclick=function(){r.hide(l,n)},r.show(l)}},{"./screen":13,hyperglue:19}],11:[function(e,t,n){"use strict";function i(){o&&(o.destroy(),o=null)}function r(e,t,n,r){var o=s(d,{".text":{_html:a("## Go to start location\n\n- Latitude: `"+t.center.latitude+"`\n- Longitude: `"+t.center.longitude+"`")}}),l=o.querySelector(".footer"),u=[o.querySelector(".text"),l];l.querySelector(".next").onclick=function(){n.destroy(),i(),c.hide(u,function(){e.innerHTML="",window.scrollTo(0,0),h.create(e,t,{},r)})},e.appendChild(o),c.show(u)}var o,s=e("hyperglue"),a=e("marked"),l=e("locatify"),u=e("./message"),c=e("./screen"),h=e("./screen-navigate"),d='<div class="screen">\n  <div class="text"></div>\n  <div class="footer">\n    <button class="next">Go!</button>\n  </div>\n</div>\n';n.create=function(e,t,n){var s=!1,a=l.create(e),c=setTimeout(function(){o||(i(),o=u.create(e,"Waiting for position data","info"))},3e3);a.on("error",function(t){clearTimeout(c),i(),o=u.create(e,t.message,"warning")}),a.on("position",function(o){clearTimeout(c),i(),o.accuracy<20&&t.within(o)?(a.destroy(),s&&(e.innerHTML="",window.scrollTo(0,0)),n()):s||(s=!0,r(e,t,a,n))})}},{"./message":4,"./screen":13,"./screen-navigate":9,hyperglue:19,locatify:21,marked:22}],12:[function(e,t,n){"use strict";var i=e("hyperglue"),r=e("marked"),o=e("./screen"),s='<div class="screen">\n  <div class="text"></div>\n  <div class="footer">\n    <button class="next">&#8594;</button>\n  </div>\n</div>\n';n.create=function(e,t,n){var a=i(s,{".text":{_html:r(t)}}),l=a.querySelector(".footer"),u=[a.querySelector(".text")];n?(u.push(l),l.querySelector(".next").onclick=function(){o.hide(u,n)}):l.style.display="none",e.appendChild(a),o.show(u)}},{"./screen":13,hyperglue:19,marked:22}],13:[function(e,t,n){"use strict";var i=e("animatify");n.show=function(e){var t=0;e.forEach(function(e){i(e,"bounceInUp",{delay:t+"s"}),t+=.2})},n.hide=function(e,t){if(!e.length)return void t();var n=0;e.reverse().forEach(function(r,o){i(r,"bounceOutDown",{delay:n+"s"},o===e.length-1?t:function(){r.style.display="none"}),n+=.2})}},{animatify:15}],14:[function(e,t,n){"use strict";function i(e,t){throw new Error('Screen "'+e+'" '+t)}function r(e,t,n){t[n]||i(e,"has no "+n)}function o(e,t,n){e[n]||i(t,'has unknown next "'+n+'"')}function s(e,t){function n(e){var t=l.indexOf(e);-1!==t&&l.splice(t,1)}var s=!1,a=Object.keys(t),l=Object.keys(e);if(a.splice(a.indexOf("start"),1),n("start"),Object.keys(e).filter(function(l){var u=e[l];switch(r(l,u,"type"),u.type){case"text":r(l,u,"text"),r(l,u,"next"),o(e,l,u.next),n(u.next);break;case"input":r(l,u,"text"),r(l,u,"answer"),r(l,u,"next"),o(e,l,u.next),n(u.next);break;case"choices":r(l,u,"text"),r(l,u,"choices"),u.next&&(o(e,l,u.next),n(u.next)),u.choices.forEach(function(t){t.text||i(l,"has choice without text"),u.next||t.next||i(l,"has choice without next"),t.next&&!e[t.next]&&i(l,'has choice with unknown next "'+t.next+'"'),t.next&&n(t.next)});break;case"navigate":r(l,u,"location");var c=t[u.location];c||i(l,'has unknown location "'+u.location+'"');var h=a.indexOf(u.location);-1!==h&&a.splice(h,1),r(l,u,"next"),o(e,l,u.next),n(u.next);break;case"finish":s=!0;break;default:i(l,'has unknown type "'+u.type+'"')}}),a.length)throw new Error('Location "'+a[0]+'" is not used');if(l.length)throw new Error('Screen "'+l[0]+'" is not used');if(!s)throw new Error('Missing "finish" screen')}function a(e,t,n,i,r){localStorage.setItem("screen",t);var o=e[t];switch(o.type){case"text":u.create(n,o.text,function(){n.innerHTML="",window.scrollTo(0,0),a(e,o.next,n,i,r)});break;case"input":c.create(n,o.text,{answer:o.answer},function(){n.innerHTML="",window.scrollTo(0,0),a(e,o.next,n,i,r)});break;case"choices":h.create(n,o.text,o.choices,function(t){if(n.innerHTML="",window.scrollTo(0,0),t.hasOwnProperty("points")){var s=localStorage.getItem("points");s=s?parseInt(s,10):0,localStorage.setItem("points",String(s+t.points))}a(e,t.next||o.next,n,i,r)});break;case"navigate":var s=i[o.location],l=o.options||{};r.demo&&(l.demo=!0),d.create(n,s,l,function(){n.innerHTML="",window.scrollTo(0,0),a(e,o.next,n,i,r)});break;case"finish":var p=parseInt(localStorage.getItem("startTime"),10),m={time:(new Date).getTime()-p},v=localStorage.getItem("points");v&&(m.points=parseInt(v,10)),f.create(n,o.text,m,function(){n.innerHTML="",window.scrollTo(0,0),g.create(n)}),localStorage.clear()}}var l=e("./location-model"),u=e("./screen-text"),c=e("./screen-input"),h=e("./screen-multiple-choice"),d=e("./screen-navigate"),f=e("./screen-finish"),p=e("./screen-start"),g=e("./screen-default");n.fromJson=function(e){function t(t,i){localStorage.getItem("startTime")||localStorage.setItem("startTime",String((new Date).getTime())),a(e.screens,i||"start",t,n,{demo:e.demo})}if(!e.locations)throw new Error("No locations");if(!e.screens)throw new Error("No screens");if(!e.locations.start)throw new Error('Missing "start" location');if(!e.screens.start)throw new Error('Missing "start" screen');var n={};return Object.keys(e.locations).forEach(function(t){n[t]=l.fromJson(e.locations[t])}),s(e.screens,n),function(i){var r=localStorage.getItem("screen");e.demo||r?t(i,r):p.create(i,n.start,function(){i.innerHTML="",window.scrollTo(0,0),t(i)})}}},{"./location-model":3,"./screen-default":5,"./screen-finish":6,"./screen-input":7,"./screen-multiple-choice":8,"./screen-navigate":9,"./screen-start":11,"./screen-text":12}],15:[function(e,t,n){"use strict";function i(e,t,n,i){function c(){e.removeEventListener(r,c),e.classList.remove("animated",t),(n.delay||n.duration||n.iterationCount)&&(e.style[l]=""),i&&i()}return"function"==typeof n?(i=n,n={}):n||(n={}),u?void(i&&i()):(n.delay&&(e.style[s]=n.delay),n.duration&&(e.style[o]=n.duration),n.iterationCount&&(e.style[a]=n.iterationCount),e.classList.add("animated",t),void e.addEventListener(r,c))}var r,o,s,a,l;!function(){var e,t,n=document.createElement("div"),i={animation:["animationend","animationDuration","animationDelay","animationIterationCount","animation"],MozAnimation:["animationend","mozAnimationDuration","mozAnimationDelay","mozAnimationIterationCount","mozAnimation"],WebkitAnimation:["webkitAnimationEnd","webkitAnimationDuration","webkitAnimationDelay","webkitAnimationIterationCount","webkitAnimation"]};for(e in i)if(i.hasOwnProperty(e)&&void 0!==n.style[e])return t=i[e],r=t[0],o=t[1],s=t[2],a=t[3],void(l=t[4])}();var u=!1;i.disable=function(){u=!0},t.exports=i},{}],16:[function(e,t,n){function i(e){if("string"!=typeof e)throw new TypeError("String expected");var t=/<([\w:]+)/.exec(e);if(!t)throw new Error("No elements were generated.");var n=t[1];if("body"==n){var i=document.createElement("html");return i.innerHTML=e,[i.removeChild(i.lastChild)]}var s=o[n]||o._default,a=s[0],l=s[1],u=s[2],i=document.createElement("div");for(i.innerHTML=l+e+u;a--;)i=i.lastChild;return r(i.children)}function r(e){for(var t=[];e.length;)t.push(e[0].parentNode.removeChild(e[0]));return t}t.exports=i;var o={option:[1,'<select multiple="multiple">',"</select>"],optgroup:[1,'<select multiple="multiple">',"</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tbody:[1,"<table>","</table>"],tfoot:[1,"<table>","</table>"],colgroup:[1,"<table>","</table>"],caption:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],th:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],_default:[0,"",""]}},{}],17:[function(e,t,n){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(e){return"function"==typeof e}function o(e){return"number"==typeof e}function s(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}t.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(e){if(!o(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},i.prototype.emit=function(e){var t,n,i,o,l,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[e],a(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(i=arguments.length,o=new Array(i-1),l=1;i>l;l++)o[l-1]=arguments[l];n.apply(this,o)}else if(s(n)){for(i=arguments.length,o=new Array(i-1),l=1;i>l;l++)o[l-1]=arguments[l];for(u=n.slice(),i=u.length,l=0;i>l;l++)u[l].apply(this,o)}return!0},i.prototype.addListener=function(e,t){var n;if(!r(t))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,r(t.listener)?t.listener:t),this._events[e]?s(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,s(this._events[e])&&!this._events[e].warned){var n;n=a(this._maxListeners)?i.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())}return this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(e,t){function n(){this.removeListener(e,n),i||(i=!0,t.apply(this,arguments))}if(!r(t))throw TypeError("listener must be a function");var i=!1;return n.listener=t,this.on(e,n),this},i.prototype.removeListener=function(e,t){var n,i,o,a;if(!r(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],o=n.length,i=-1,n===t||r(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(s(n)){for(a=o;a-->0;)if(n[a]===t||n[a].listener&&n[a].listener===t){i=a;break}if(0>i)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},i.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],r(n))this.removeListener(e,n);else for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},i.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?r(this._events[e])?[this._events[e]]:this._events[e].slice():[]},i.listenerCount=function(e,t){var n;return n=e._events&&e._events[t]?r(e._events[t])?1:e._events[t].length:0}},{}],18:[function(e,t,n){!function(e,n){"use strict";function i(){}var r=Object.create(i.prototype,{version:{value:"2.0.17"},radius:{value:6378137},minLat:{value:-90},maxLat:{value:90},minLon:{value:-180},maxLon:{value:180},sexagesimalPattern:{value:/^([0-9]{1,3})°\s*([0-9]{1,3}(?:\.(?:[0-9]{1,2}))?)'\s*(([0-9]{1,3}(\.([0-9]{1,2}))?)"\s*)?([NEOSW]?)$/},measures:{value:Object.create(Object.prototype,{m:{value:1},km:{value:.001},cm:{value:100},mm:{value:1e3},mi:{value:1/1609.344},sm:{value:1/1852.216},ft:{value:100/30.48},"in":{value:100/2.54},yd:{value:1/.9144}})},prototype:{value:i.prototype},extend:{value:function(e,t){for(var n in e)("undefined"==typeof r.prototype[n]||t===!0)&&("function"==typeof e[n]&&"function"==typeof e[n].bind?r.prototype[n]=e[n].bind(r):r.prototype[n]=e[n])}}});"undefined"==typeof Number.prototype.toRad&&(Number.prototype.toRad=function(){return this*Math.PI/180}),"undefined"==typeof Number.prototype.toDeg&&(Number.prototype.toDeg=function(){return 180*this/Math.PI}),r.extend({decimal:{},sexagesimal:{},distance:null,getKeys:function(e){if("[object Array]"==Object.prototype.toString.call(e))return{longitude:e.length>=1?0:n,latitude:e.length>=2?1:n,elevation:e.length>=3?2:n};var t=function(t){var n;return t.every(function(t){return"object"!=typeof e?!0:e.hasOwnProperty(t)?function(){return n=t,!1}():!0}),n},i=t(["lng","lon","longitude"]),r=t(["lat","latitude"]),o=t(["alt","altitude","elevation","elev"]);return"undefined"==typeof r&&"undefined"==typeof i&&"undefined"==typeof o?n:{latitude:r,longitude:i,elevation:o}},getLat:function(e,t){return t===!0?e[this.getKeys(e).latitude]:this.useDecimal(e[this.getKeys(e).latitude])},latitude:function(e){return this.getLat.call(this,e)},getLon:function(e,t){return t===!0?e[this.getKeys(e).longitude]:this.useDecimal(e[this.getKeys(e).longitude])},longitude:function(e){return this.getLon.call(this,e)},getElev:function(e){return e[this.getKeys(e).elevation]},elevation:function(e){return this.getElev.call(this,e)},coords:function(e,t){var n={latitude:t===!0?e[this.getKeys(e).latitude]:this.useDecimal(e[this.getKeys(e).latitude]),longitude:t===!0?e[this.getKeys(e).longitude]:this.useDecimal(e[this.getKeys(e).longitude])},i=e[this.getKeys(e).elevation];return"undefined"!=typeof i&&(n.elevation=i),n},ll:function(e,t){return this.coords.call(this,e,t)},validate:function(e){var t=this.getKeys(e);if("undefined"==typeof t||"undefined"==typeof t.latitude||"undefined"===t.longitude)return!1;var n=e[t.latitude],i=e[t.longitude];return"undefined"==typeof n||!this.isDecimal(n)&&!this.isSexagesimal(n)?!1:"undefined"==typeof i||!this.isDecimal(i)&&!this.isSexagesimal(i)?!1:(n=this.useDecimal(n),i=this.useDecimal(i),n<this.minLat||n>this.maxLat||i<this.minLon||i>this.maxLon?!1:!0)},getDistance:function(e,t,n){n=Math.floor(n)||1;var i,o,s,a,l,u,c,h=this.coords(e),d=this.coords(t),f=6378137,p=6356752.314245,g=1/298.257223563,m=(d.longitude-h.longitude).toRad(),v=Math.atan((1-g)*Math.tan(parseFloat(h.latitude).toRad())),y=Math.atan((1-g)*Math.tan(parseFloat(d.latitude).toRad())),b=Math.sin(v),x=Math.cos(v),k=Math.sin(y),w=Math.cos(y),L=m,M=100;do{var S=Math.sin(L),_=Math.cos(L);if(u=Math.sqrt(w*S*w*S+(x*k-b*w*_)*(x*k-b*w*_)),0===u)return r.distance=0;i=b*k+x*w*_,o=Math.atan2(u,i),s=x*w*S/u,a=1-s*s,l=i-2*b*k/a,isNaN(l)&&(l=0);var E=g/16*a*(4+g*(4-3*a));c=L,L=m+(1-E)*g*s*(o+E*u*(l+E*i*(-1+2*l*l)))}while(Math.abs(L-c)>1e-12&&--M>0);if(0===M)return NaN;var C=a*(f*f-p*p)/(p*p),q=1+C/16384*(4096+C*(-768+C*(320-175*C))),T=C/1024*(256+C*(-128+C*(74-47*C))),I=T*u*(l+T/4*(i*(-1+2*l*l)-T/6*l*(-3+4*u*u)*(-3+4*l*l))),A=p*q*(o-I);if(A=A.toFixed(3),"undefined"!=typeof this.elevation(e)&&"undefined"!=typeof this.elevation(t)){var D=Math.abs(this.elevation(e)-this.elevation(t));A=Math.sqrt(A*A+D*D)}return this.distance=Math.floor(Math.round(A/n)*n)},getDistanceSimple:function(e,t,n){n=Math.floor(n)||1;var i=Math.round(Math.acos(Math.sin(this.latitude(t).toRad())*Math.sin(this.latitude(e).toRad())+Math.cos(this.latitude(t).toRad())*Math.cos(this.latitude(e).toRad())*Math.cos(this.longitude(e).toRad()-this.longitude(t).toRad()))*this.radius);return r.distance=Math.floor(Math.round(i/n)*n)},getCenter:function(e){if(!e.length)return!1;var t,n,i,r=0,o=0,s=0;e.forEach(function(e){t=e.latitude*Math.PI/180,n=e.longitude*Math.PI/180,r+=Math.cos(t)*Math.cos(n),o+=Math.cos(t)*Math.sin(n),s+=Math.sin(t)});var a=e.length;return r/=a,o/=a,s/=a,n=Math.atan2(o,r),i=Math.sqrt(r*r+o*o),t=Math.atan2(s,i),{latitude:(180*t/Math.PI).toFixed(6),longitude:(180*n/Math.PI).toFixed(6)}},getBounds:function(e){if(!e.length)return!1;var t=this.elevation(e[0]),n={maxLat:-(1/0),minLat:1/0,maxLng:-(1/0),minLng:1/0};"undefined"!=typeof t&&(n.maxElev=0,n.minElev=1/0);for(var i=0,r=e.length;r>i;++i)n.maxLat=Math.max(this.latitude(e[i]),n.maxLat),n.minLat=Math.min(this.latitude(e[i]),n.minLat),n.maxLng=Math.max(this.longitude(e[i]),n.maxLng),n.minLng=Math.min(this.longitude(e[i]),n.minLng),t&&(n.maxElev=Math.max(this.elevation(e[i]),n.maxElev),n.minElev=Math.min(this.elevation(e[i]),n.minElev));return n},getBoundsOfDistance:function(e,t){var n,i,r=this.latitude(e),o=this.longitude(e),s=r.toRad(),a=o.toRad(),l=t/this.radius,u=s-l,c=s+l,h=this.maxLat.toRad(),d=this.minLat.toRad(),f=this.maxLon.toRad(),p=this.minLon.toRad();if(u>d&&h>c){var g=Math.asin(Math.sin(l)/Math.cos(s));n=a-g,p>n&&(n+=2*Math.PI),i=a+g,i>f&&(i-=2*Math.PI)}else u=Math.max(u,d),c=Math.min(c,h),n=p,i=f;return[{latitude:u.toDeg(),longitude:n.toDeg()},{latitude:c.toDeg(),longitude:i.toDeg()}]},isPointInside:function(e,t){for(var n=!1,i=-1,r=t.length,o=r-1;++i<r;o=i)(this.longitude(t[i])<=this.longitude(e)&&this.longitude(e)<this.longitude(t[o])||this.longitude(t[o])<=this.longitude(e)&&this.longitude(e)<this.longitude(t[i]))&&this.latitude(e)<(this.latitude(t[o])-this.latitude(t[i]))*(this.longitude(e)-this.longitude(t[i]))/(this.longitude(t[o])-this.longitude(t[i]))+this.latitude(t[i])&&(n=!n);return n},preparePolygonForIsPointInsideOptimized:function(e){for(var t=0,n=e.length-1;t<e.length;t++)this.longitude(e[n])===this.longitude(e[t])?(e[t].constant=this.latitude(e[t]),e[t].multiple=0):(e[t].constant=this.latitude(e[t])-this.longitude(e[t])*this.latitude(e[n])/(this.longitude(e[n])-this.longitude(e[t]))+this.longitude(e[t])*this.latitude(e[t])/(this.longitude(e[n])-this.longitude(e[t])),e[t].multiple=(this.latitude(e[n])-this.latitude(e[t]))/(this.longitude(e[n])-this.longitude(e[t]))),n=t},isPointInsideWithPreparedPolygon:function(e,t){for(var n=!1,i=this.longitude(e),r=this.latitude(e),o=0,s=t.length-1;o<t.length;o++)(this.longitude(t[o])<i&&this.longitude(t[s])>=i||this.longitude(t[s])<i&&this.longitude(t[o])>=i)&&(n^=i*t[o].multiple+t[o].constant<r),s=o;return n},isInside:function(){return this.isPointInside.apply(this,arguments)},isPointInCircle:function(e,t,n){return this.getDistance(e,t)<n},withinRadius:function(){return this.isPointInCircle.apply(this,arguments)},getRhumbLineBearing:function(e,t){var n=this.longitude(t).toRad()-this.longitude(e).toRad(),i=Math.log(Math.tan(this.latitude(t).toRad()/2+Math.PI/4)/Math.tan(this.latitude(e).toRad()/2+Math.PI/4));return Math.abs(n)>Math.PI&&(n=n>0?-1*(2*Math.PI-n):2*Math.PI+n),(Math.atan2(n,i).toDeg()+360)%360},getBearing:function(e,t){t.latitude=this.latitude(t),t.longitude=this.longitude(t),e.latitude=this.latitude(e),e.longitude=this.longitude(e);var n=(Math.atan2(Math.sin(t.longitude.toRad()-e.longitude.toRad())*Math.cos(t.latitude.toRad()),Math.cos(e.latitude.toRad())*Math.sin(t.latitude.toRad())-Math.sin(e.latitude.toRad())*Math.cos(t.latitude.toRad())*Math.cos(t.longitude.toRad()-e.longitude.toRad())).toDeg()+360)%360;return n},getCompassDirection:function(e,t,n){var i,r;switch(r="circle"==n?this.getBearing(e,t):this.getRhumbLineBearing(e,t),Math.round(r/22.5)){case 1:i={exact:"NNE",rough:"N"};break;case 2:i={exact:"NE",rough:"N"};break;case 3:i={exact:"ENE",rough:"E"};break;case 4:i={exact:"E",rough:"E"};break;case 5:i={exact:"ESE",rough:"E"};break;case 6:i={exact:"SE",rough:"E"};break;case 7:i={exact:"SSE",rough:"S"};break;case 8:i={exact:"S",rough:"S"};break;case 9:i={exact:"SSW",rough:"S"};break;case 10:i={exact:"SW",rough:"S"};break;case 11:i={exact:"WSW",rough:"W"};break;case 12:i={exact:"W",rough:"W"};break;case 13:i={exact:"WNW",rough:"W"};break;case 14:i={exact:"NW",rough:"W"};break;case 15:i={exact:"NNW",rough:"N"};break;default:i={exact:"N",rough:"N"}}return i.bearing=r,i},getDirection:function(e,t,n){return this.getCompassDirection.apply(this,arguments)},orderByDistance:function(e,t){var n=[];for(var i in t){var r=this.getDistance(e,t[i]);n.push({key:i,latitude:this.latitude(t[i]),longitude:this.longitude(t[i]),distance:r})}return n.sort(function(e,t){return e.distance-t.distance})},findNearest:function(e,t,n,i){n=n||0,i=i||1;var r=this.orderByDistance(e,t);return 1===i?r[n]:r.splice(n,i)},getPathLength:function(e){for(var t,n=0,i=0,r=e.length;r>i;++i)t&&(n+=this.getDistance(this.coords(e[i]),t)),t=this.coords(e[i]);return n},getSpeed:function(e,t,n){var i=n&&n.unit||"km";"mph"==i?i="mi":"kmh"==i&&(i="km");var o=r.getDistance(e,t),s=1*t.time/1e3-1*e.time/1e3,a=o/s*3600,l=Math.round(a*this.measures[i]*1e4)/1e4;return l},convertUnit:function(e,t,n){if(0===t)return 0;if("undefined"==typeof t){if(null===this.distance)throw new Error("No distance was given");if(0===this.distance)return 0;t=this.distance}if(e=e||"m",n=null==n?4:n,"undefined"!=typeof this.measures[e])return this.round(t*this.measures[e],n);throw new Error("Unknown unit for conversion.")},useDecimal:function(e){if("[object Array]"===Object.prototype.toString.call(e)){var t=this;return e=e.map(function(e){if(t.isDecimal(e))return t.useDecimal(e);if("object"==typeof e){if(t.validate(e))return t.coords(e);for(var n in e)e[n]=t.useDecimal(e[n]);return e}return t.isSexagesimal(e)?t.sexagesimal2decimal(e):e})}if("object"==typeof e&&this.validate(e))return this.coords(e);if("object"==typeof e){for(var n in e)e[n]=this.useDecimal(e[n]);return e}if(this.isDecimal(e))return parseFloat(e);if(this.isSexagesimal(e)===!0)return parseFloat(this.sexagesimal2decimal(e));throw new Error("Unknown format.")},decimal2sexagesimal:function(e){if(e in this.sexagesimal)return this.sexagesimal[e];var t=e.toString().split("."),n=Math.abs(t[0]),i=60*("0."+t[1]),r=i.toString().split(".");return i=Math.floor(i),r=(60*("0."+r[1])).toFixed(2),this.sexagesimal[e]=n+"° "+i+"' "+r+'"',this.sexagesimal[e]},sexagesimal2decimal:function(e){if(e in this.decimal)return this.decimal[e];var t=new RegExp(this.sexagesimalPattern),n=t.exec(e),i=0,r=0;n&&(i=parseFloat(n[2]/60),r=parseFloat(n[4]/3600)||0);
var o=(parseFloat(n[1])+i+r).toFixed(8);return o="S"==n[7]||"W"==n[7]?parseFloat(-o):parseFloat(o),this.decimal[e]=o,o},isDecimal:function(e){return e=e.toString().replace(/\s*/,""),!isNaN(parseFloat(e))&&parseFloat(e)==e},isSexagesimal:function(e){return e=e.toString().replace(/\s*/,""),this.sexagesimalPattern.test(e)},round:function(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n}}),"undefined"!=typeof t&&"undefined"!=typeof t.exports?e.geolib=t.exports=r:"function"==typeof define&&define.amd?define("geolib",[],function(){return r}):e.geolib=r}(this)},{}],19:[function(e,t,n){function i(e,t){t||(t={});var n="object"==typeof e?[e]:l(e);return u||(u=document.createElement("div")),o(c(t),function(e){var i=t[e];o(n,function(t){var n=t.parentNode;if(":first"===e)r(t,i);else if(/:first$/.test(e)){var o=e.replace(/:first$/,"");n&&n.removeChild(t),u.appendChild(t);var s=u.querySelector(o);u.removeChild(t),n&&n.appendChild(t),s&&r(s,i)}else{n&&n.removeChild(t),u.appendChild(t);var a=t.parentNode.querySelectorAll(e);if(u.removeChild(t),n&&n.appendChild(t),0===a.length)return;for(var l=0;l<a.length;l++)r(a[l],i)}})}),1===n.length?n[0]:n}function r(e,t){if(s(t))e.innerHTML="",e.appendChild(t);else if(h(t)){for(var n=0;n<t.length;n++){var r=i(e.cloneNode(!0),t[n]);e.parentNode.insertBefore(r,e)}e.parentNode.removeChild(e)}else t&&"object"==typeof t?o(c(t),function(n){if("_text"===n)a(e,t[n]);else if("_html"===n&&s(t[n]))e.innerHTML="",e.appendChild(t[n]);else if("_html"===n)e.innerHTML=t[n];else if(t[n]&&"object"==typeof t[n]){var i=t[n];i.append?e.setAttribute(n,e.getAttribute(n)+i.append):i.prepend&&e.setAttribute(n,i.prepend+e.getAttribute(n))}else e.setAttribute(n,t[n])}):a(e,t)}function o(e,t){if(e.forEach)return e.forEach(t);for(var n=0;n<e.length;n++)t(e[n],n)}function s(e){return e&&"object"==typeof e&&e.childNodes&&("function"==typeof e.appendChild||"object"==typeof e.appendChild)}function a(e,t){e.innerHTML="";var n=document.createTextNode(String(t));e.appendChild(n)}var l=e("domify");t.exports=i;var u=null,c=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t},h=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{domify:16}],20:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],21:[function(e,t,n){(function(t){"use strict";var i=e("events"),r={1:"Position tracking not allowed",2:"Position tracking unavailable",3:"Position tracking timeout",DEFAULT:"Position tracking error"};n.create=function(){function e(e){a.emit("position",{latitude:e.coords.latitude,longitude:e.coords.longitude,accuracy:e.coords.accuracy})}function n(e){var t=new Error(r[e.code]||r.DEFAULT);t.code=e.code,a.emit("error",t)}function o(e){var t;if(e.hasOwnProperty("webkitCompassHeading")){if(t=e.webkitCompassHeading,"number"!=typeof t)return;t=Math.floor(t)}else{if("number"!=typeof e.alpha)return;t=360-Math.floor(e.alpha)}t!==s&&(s=t,a.emit("heading",t))}var s,a=new i.EventEmitter,l=navigator.geolocation.watchPosition(e,n,{enableHighAccuracy:!0,maximumAge:0});return t.addEventListener("deviceorientation",o,!1),a.destroy=function(){t.removeEventListener("deviceorientation",o),a.removeAllListeners(),navigator.geolocation.clearWatch(l)},a}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{events:17}],22:[function(e,t,n){(function(e){(function(){function e(e){this.tokens=[],this.tokens.links={},this.options=e||h.defaults,this.rules=d.normal,this.options.gfm&&(this.options.tables?this.rules=d.tables:this.rules=d.gfm)}function i(e,t){if(this.options=t||h.defaults,this.links=e,this.rules=f.normal,this.renderer=this.options.renderer||new r,this.renderer.options=this.options,!this.links)throw new Error("Tokens array requires a `links` property.");this.options.gfm?this.options.breaks?this.rules=f.breaks:this.rules=f.gfm:this.options.pedantic&&(this.rules=f.pedantic)}function r(e){this.options=e||{}}function o(e){this.tokens=[],this.token=null,this.options=e||h.defaults,this.options.renderer=this.options.renderer||new r,this.renderer=this.options.renderer,this.renderer.options=this.options}function s(e,t){return e.replace(t?/&/g:/&(?!#?\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function a(e){return e.replace(/&([#\w]+);/g,function(e,t){return t=t.toLowerCase(),"colon"===t?":":"#"===t.charAt(0)?"x"===t.charAt(1)?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1)):""})}function l(e,t){return e=e.source,t=t||"",function n(i,r){return i?(r=r.source||r,r=r.replace(/(^|[^\[])\^/g,"$1"),e=e.replace(i,r),n):new RegExp(e,t)}}function u(){}function c(e){for(var t,n,i=1;i<arguments.length;i++){t=arguments[i];for(n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}function h(t,n,i){if(i||"function"==typeof n){i||(i=n,n=null),n=c({},h.defaults,n||{});var r,a,l=n.highlight,u=0;try{r=e.lex(t,n)}catch(d){return i(d)}a=r.length;var f=function(e){if(e)return n.highlight=l,i(e);var t;try{t=o.parse(r,n)}catch(s){e=s}return n.highlight=l,e?i(e):i(null,t)};if(!l||l.length<3)return f();if(delete n.highlight,!a)return f();for(;u<r.length;u++)!function(e){return"code"!==e.type?--a||f():l(e.text,e.lang,function(t,n){return t?f(t):null==n||n===e.text?--a||f():(e.text=n,e.escaped=!0,void(--a||f()))})}(r[u])}else try{return n&&(n=c({},h.defaults,n)),o.parse(e.lex(t,n),n)}catch(d){if(d.message+="\nPlease report this to https://github.com/chjj/marked.",(n||h.defaults).silent)return"<p>An error occured:</p><pre>"+s(d.message+"",!0)+"</pre>";throw d}}var d={newline:/^\n+/,code:/^( {4}[^\n]+\n*)+/,fences:u,hr:/^( *[-*_]){3,} *(?:\n+|$)/,heading:/^ *(#{1,6}) *([^\n]+?) *#* *(?:\n+|$)/,nptable:u,lheading:/^([^\n]+)\n *(=|-){2,} *(?:\n+|$)/,blockquote:/^( *>[^\n]+(\n(?!def)[^\n]+)*\n*)+/,list:/^( *)(bull) [\s\S]+?(?:hr|def|\n{2,}(?! )(?!\1bull )\n*|\s*$)/,html:/^ *(?:comment *(?:\n|\s*$)|closed *(?:\n{2,}|\s*$)|closing *(?:\n{2,}|\s*$))/,def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +["(]([^\n]+)[")])? *(?:\n+|$)/,table:u,paragraph:/^((?:[^\n]+\n?(?!hr|heading|lheading|blockquote|tag|def))+)\n*/,text:/^[^\n]+/};d.bullet=/(?:[*+-]|\d+\.)/,d.item=/^( *)(bull) [^\n]*(?:\n(?!\1bull )[^\n]*)*/,d.item=l(d.item,"gm")(/bull/g,d.bullet)(),d.list=l(d.list)(/bull/g,d.bullet)("hr","\\n+(?=\\1?(?:[-*_] *){3,}(?:\\n+|$))")("def","\\n+(?="+d.def.source+")")(),d.blockquote=l(d.blockquote)("def",d.def)(),d._tag="(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:/|[^\\w\\s@]*@)\\b",d.html=l(d.html)("comment",/<!--[\s\S]*?-->/)("closed",/<(tag)[\s\S]+?<\/\1>/)("closing",/<tag(?:"[^"]*"|'[^']*'|[^'">])*?>/)(/tag/g,d._tag)(),d.paragraph=l(d.paragraph)("hr",d.hr)("heading",d.heading)("lheading",d.lheading)("blockquote",d.blockquote)("tag","<"+d._tag)("def",d.def)(),d.normal=c({},d),d.gfm=c({},d.normal,{fences:/^ *(`{3,}|~{3,}) *(\S+)? *\n([\s\S]+?)\s*\1 *(?:\n+|$)/,paragraph:/^/}),d.gfm.paragraph=l(d.paragraph)("(?!","(?!"+d.gfm.fences.source.replace("\\1","\\2")+"|"+d.list.source.replace("\\1","\\3")+"|")(),d.tables=c({},d.gfm,{nptable:/^ *(\S.*\|.*)\n *([-:]+ *\|[-| :]*)\n((?:.*\|.*(?:\n|$))*)\n*/,table:/^ *\|(.+)\n *\|( *[-:]+[-| :]*)\n((?: *\|.*(?:\n|$))*)\n*/}),e.rules=d,e.lex=function(t,n){var i=new e(n);return i.lex(t)},e.prototype.lex=function(e){return e=e.replace(/\r\n|\r/g,"\n").replace(/\t/g,"    ").replace(/\u00a0/g," ").replace(/\u2424/g,"\n"),this.token(e,!0)},e.prototype.token=function(e,t,n){for(var i,r,o,s,a,l,u,c,h,e=e.replace(/^ +$/gm,"");e;)if((o=this.rules.newline.exec(e))&&(e=e.substring(o[0].length),o[0].length>1&&this.tokens.push({type:"space"})),o=this.rules.code.exec(e))e=e.substring(o[0].length),o=o[0].replace(/^ {4}/gm,""),this.tokens.push({type:"code",text:this.options.pedantic?o:o.replace(/\n+$/,"")});else if(o=this.rules.fences.exec(e))e=e.substring(o[0].length),this.tokens.push({type:"code",lang:o[2],text:o[3]});else if(o=this.rules.heading.exec(e))e=e.substring(o[0].length),this.tokens.push({type:"heading",depth:o[1].length,text:o[2]});else if(t&&(o=this.rules.nptable.exec(e))){for(e=e.substring(o[0].length),l={type:"table",header:o[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:o[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:o[3].replace(/\n$/,"").split("\n")},c=0;c<l.align.length;c++)/^ *-+: *$/.test(l.align[c])?l.align[c]="right":/^ *:-+: *$/.test(l.align[c])?l.align[c]="center":/^ *:-+ *$/.test(l.align[c])?l.align[c]="left":l.align[c]=null;for(c=0;c<l.cells.length;c++)l.cells[c]=l.cells[c].split(/ *\| */);this.tokens.push(l)}else if(o=this.rules.lheading.exec(e))e=e.substring(o[0].length),this.tokens.push({type:"heading",depth:"="===o[2]?1:2,text:o[1]});else if(o=this.rules.hr.exec(e))e=e.substring(o[0].length),this.tokens.push({type:"hr"});else if(o=this.rules.blockquote.exec(e))e=e.substring(o[0].length),this.tokens.push({type:"blockquote_start"}),o=o[0].replace(/^ *> ?/gm,""),this.token(o,t,!0),this.tokens.push({type:"blockquote_end"});else if(o=this.rules.list.exec(e)){for(e=e.substring(o[0].length),s=o[2],this.tokens.push({type:"list_start",ordered:s.length>1}),o=o[0].match(this.rules.item),i=!1,h=o.length,c=0;h>c;c++)l=o[c],u=l.length,l=l.replace(/^ *([*+-]|\d+\.) +/,""),~l.indexOf("\n ")&&(u-=l.length,l=this.options.pedantic?l.replace(/^ {1,4}/gm,""):l.replace(new RegExp("^ {1,"+u+"}","gm"),"")),this.options.smartLists&&c!==h-1&&(a=d.bullet.exec(o[c+1])[0],s===a||s.length>1&&a.length>1||(e=o.slice(c+1).join("\n")+e,c=h-1)),r=i||/\n\n(?!\s*$)/.test(l),c!==h-1&&(i="\n"===l.charAt(l.length-1),r||(r=i)),this.tokens.push({type:r?"loose_item_start":"list_item_start"}),this.token(l,!1,n),this.tokens.push({type:"list_item_end"});this.tokens.push({type:"list_end"})}else if(o=this.rules.html.exec(e))e=e.substring(o[0].length),this.tokens.push({type:this.options.sanitize?"paragraph":"html",pre:"pre"===o[1]||"script"===o[1]||"style"===o[1],text:o[0]});else if(!n&&t&&(o=this.rules.def.exec(e)))e=e.substring(o[0].length),this.tokens.links[o[1].toLowerCase()]={href:o[2],title:o[3]};else if(t&&(o=this.rules.table.exec(e))){for(e=e.substring(o[0].length),l={type:"table",header:o[1].replace(/^ *| *\| *$/g,"").split(/ *\| */),align:o[2].replace(/^ *|\| *$/g,"").split(/ *\| */),cells:o[3].replace(/(?: *\| *)?\n$/,"").split("\n")},c=0;c<l.align.length;c++)/^ *-+: *$/.test(l.align[c])?l.align[c]="right":/^ *:-+: *$/.test(l.align[c])?l.align[c]="center":/^ *:-+ *$/.test(l.align[c])?l.align[c]="left":l.align[c]=null;for(c=0;c<l.cells.length;c++)l.cells[c]=l.cells[c].replace(/^ *\| *| *\| *$/g,"").split(/ *\| */);this.tokens.push(l)}else if(t&&(o=this.rules.paragraph.exec(e)))e=e.substring(o[0].length),this.tokens.push({type:"paragraph",text:"\n"===o[1].charAt(o[1].length-1)?o[1].slice(0,-1):o[1]});else if(o=this.rules.text.exec(e))e=e.substring(o[0].length),this.tokens.push({type:"text",text:o[0]});else if(e)throw new Error("Infinite loop on byte: "+e.charCodeAt(0));return this.tokens};var f={escape:/^\\([\\`*{}\[\]()#+\-.!_>])/,autolink:/^<([^ >]+(@|:\/)[^ >]+)>/,url:u,tag:/^<!--[\s\S]*?-->|^<\/?\w+(?:"[^"]*"|'[^']*'|[^'">])*?>/,link:/^!?\[(inside)\]\(href\)/,reflink:/^!?\[(inside)\]\s*\[([^\]]*)\]/,nolink:/^!?\[((?:\[[^\]]*\]|[^\[\]])*)\]/,strong:/^__([\s\S]+?)__(?!_)|^\*\*([\s\S]+?)\*\*(?!\*)/,em:/^\b_((?:__|[\s\S])+?)_\b|^\*((?:\*\*|[\s\S])+?)\*(?!\*)/,code:/^(`+)\s*([\s\S]*?[^`])\s*\1(?!`)/,br:/^ {2,}\n(?!\s*$)/,del:u,text:/^[\s\S]+?(?=[\\<!\[_*`]| {2,}\n|$)/};f._inside=/(?:\[[^\]]*\]|[^\[\]]|\](?=[^\[]*\]))*/,f._href=/\s*<?([\s\S]*?)>?(?:\s+['"]([\s\S]*?)['"])?\s*/,f.link=l(f.link)("inside",f._inside)("href",f._href)(),f.reflink=l(f.reflink)("inside",f._inside)(),f.normal=c({},f),f.pedantic=c({},f.normal,{strong:/^__(?=\S)([\s\S]*?\S)__(?!_)|^\*\*(?=\S)([\s\S]*?\S)\*\*(?!\*)/,em:/^_(?=\S)([\s\S]*?\S)_(?!_)|^\*(?=\S)([\s\S]*?\S)\*(?!\*)/}),f.gfm=c({},f.normal,{escape:l(f.escape)("])","~|])")(),url:/^(https?:\/\/[^\s<]+[^<.,:;"')\]\s])/,del:/^~~(?=\S)([\s\S]*?\S)~~/,text:l(f.text)("]|","~]|")("|","|https?://|")()}),f.breaks=c({},f.gfm,{br:l(f.br)("{2,}","*")(),text:l(f.gfm.text)("{2,}","*")()}),i.rules=f,i.output=function(e,t,n){var r=new i(t,n);return r.output(e)},i.prototype.output=function(e){for(var t,n,i,r,o="";e;)if(r=this.rules.escape.exec(e))e=e.substring(r[0].length),o+=r[1];else if(r=this.rules.autolink.exec(e))e=e.substring(r[0].length),"@"===r[2]?(n=":"===r[1].charAt(6)?this.mangle(r[1].substring(7)):this.mangle(r[1]),i=this.mangle("mailto:")+n):(n=s(r[1]),i=n),o+=this.renderer.link(i,null,n);else if(this.inLink||!(r=this.rules.url.exec(e))){if(r=this.rules.tag.exec(e))!this.inLink&&/^<a /i.test(r[0])?this.inLink=!0:this.inLink&&/^<\/a>/i.test(r[0])&&(this.inLink=!1),e=e.substring(r[0].length),o+=this.options.sanitize?s(r[0]):r[0];else if(r=this.rules.link.exec(e))e=e.substring(r[0].length),this.inLink=!0,o+=this.outputLink(r,{href:r[2],title:r[3]}),this.inLink=!1;else if((r=this.rules.reflink.exec(e))||(r=this.rules.nolink.exec(e))){if(e=e.substring(r[0].length),t=(r[2]||r[1]).replace(/\s+/g," "),t=this.links[t.toLowerCase()],!t||!t.href){o+=r[0].charAt(0),e=r[0].substring(1)+e;continue}this.inLink=!0,o+=this.outputLink(r,t),this.inLink=!1}else if(r=this.rules.strong.exec(e))e=e.substring(r[0].length),o+=this.renderer.strong(this.output(r[2]||r[1]));else if(r=this.rules.em.exec(e))e=e.substring(r[0].length),o+=this.renderer.em(this.output(r[2]||r[1]));else if(r=this.rules.code.exec(e))e=e.substring(r[0].length),o+=this.renderer.codespan(s(r[2],!0));else if(r=this.rules.br.exec(e))e=e.substring(r[0].length),o+=this.renderer.br();else if(r=this.rules.del.exec(e))e=e.substring(r[0].length),o+=this.renderer.del(this.output(r[1]));else if(r=this.rules.text.exec(e))e=e.substring(r[0].length),o+=s(this.smartypants(r[0]));else if(e)throw new Error("Infinite loop on byte: "+e.charCodeAt(0))}else e=e.substring(r[0].length),n=s(r[1]),i=n,o+=this.renderer.link(i,null,n);return o},i.prototype.outputLink=function(e,t){var n=s(t.href),i=t.title?s(t.title):null;return"!"!==e[0].charAt(0)?this.renderer.link(n,i,this.output(e[1])):this.renderer.image(n,i,s(e[1]))},i.prototype.smartypants=function(e){return this.options.smartypants?e.replace(/--/g,"—").replace(/(^|[-\u2014\/(\[{"\s])'/g,"$1‘").replace(/'/g,"’").replace(/(^|[-\u2014\/(\[{\u2018\s])"/g,"$1“").replace(/"/g,"”").replace(/\.{3}/g,"…"):e},i.prototype.mangle=function(e){for(var t,n="",i=e.length,r=0;i>r;r++)t=e.charCodeAt(r),Math.random()>.5&&(t="x"+t.toString(16)),n+="&#"+t+";";return n},r.prototype.code=function(e,t,n){if(this.options.highlight){var i=this.options.highlight(e,t);null!=i&&i!==e&&(n=!0,e=i)}return t?'<pre><code class="'+this.options.langPrefix+s(t,!0)+'">'+(n?e:s(e,!0))+"\n</code></pre>\n":"<pre><code>"+(n?e:s(e,!0))+"\n</code></pre>"},r.prototype.blockquote=function(e){return"<blockquote>\n"+e+"</blockquote>\n"},r.prototype.html=function(e){return e},r.prototype.heading=function(e,t,n){return"<h"+t+' id="'+this.options.headerPrefix+n.toLowerCase().replace(/[^\w]+/g,"-")+'">'+e+"</h"+t+">\n"},r.prototype.hr=function(){return this.options.xhtml?"<hr/>\n":"<hr>\n"},r.prototype.list=function(e,t){var n=t?"ol":"ul";return"<"+n+">\n"+e+"</"+n+">\n"},r.prototype.listitem=function(e){return"<li>"+e+"</li>\n"},r.prototype.paragraph=function(e){return"<p>"+e+"</p>\n"},r.prototype.table=function(e,t){return"<table>\n<thead>\n"+e+"</thead>\n<tbody>\n"+t+"</tbody>\n</table>\n"},r.prototype.tablerow=function(e){return"<tr>\n"+e+"</tr>\n"},r.prototype.tablecell=function(e,t){var n=t.header?"th":"td",i=t.align?"<"+n+' style="text-align:'+t.align+'">':"<"+n+">";return i+e+"</"+n+">\n"},r.prototype.strong=function(e){return"<strong>"+e+"</strong>"},r.prototype.em=function(e){return"<em>"+e+"</em>"},r.prototype.codespan=function(e){return"<code>"+e+"</code>"},r.prototype.br=function(){return this.options.xhtml?"<br/>":"<br>"},r.prototype.del=function(e){return"<del>"+e+"</del>"},r.prototype.link=function(e,t,n){if(this.options.sanitize){try{var i=decodeURIComponent(a(e)).replace(/[^\w:]/g,"").toLowerCase()}catch(r){return""}if(0===i.indexOf("javascript:")||0===i.indexOf("vbscript:"))return""}var o='<a href="'+e+'"';return t&&(o+=' title="'+t+'"'),o+=">"+n+"</a>"},r.prototype.image=function(e,t,n){var i='<img src="'+e+'" alt="'+n+'"';return t&&(i+=' title="'+t+'"'),i+=this.options.xhtml?"/>":">"},o.parse=function(e,t,n){var i=new o(t,n);return i.parse(e)},o.prototype.parse=function(e){this.inline=new i(e.links,this.options,this.renderer),this.tokens=e.reverse();for(var t="";this.next();)t+=this.tok();return t},o.prototype.next=function(){return this.token=this.tokens.pop()},o.prototype.peek=function(){return this.tokens[this.tokens.length-1]||0},o.prototype.parseText=function(){for(var e=this.token.text;"text"===this.peek().type;)e+="\n"+this.next().text;return this.inline.output(e)},o.prototype.tok=function(){switch(this.token.type){case"space":return"";case"hr":return this.renderer.hr();case"heading":return this.renderer.heading(this.inline.output(this.token.text),this.token.depth,this.token.text);case"code":return this.renderer.code(this.token.text,this.token.lang,this.token.escaped);case"table":var e,t,n,i,r,o="",s="";for(n="",e=0;e<this.token.header.length;e++)i={header:!0,align:this.token.align[e]},n+=this.renderer.tablecell(this.inline.output(this.token.header[e]),{header:!0,align:this.token.align[e]});for(o+=this.renderer.tablerow(n),e=0;e<this.token.cells.length;e++){for(t=this.token.cells[e],n="",r=0;r<t.length;r++)n+=this.renderer.tablecell(this.inline.output(t[r]),{header:!1,align:this.token.align[r]});s+=this.renderer.tablerow(n)}return this.renderer.table(o,s);case"blockquote_start":for(var s="";"blockquote_end"!==this.next().type;)s+=this.tok();return this.renderer.blockquote(s);case"list_start":for(var s="",a=this.token.ordered;"list_end"!==this.next().type;)s+=this.tok();return this.renderer.list(s,a);case"list_item_start":for(var s="";"list_item_end"!==this.next().type;)s+="text"===this.token.type?this.parseText():this.tok();return this.renderer.listitem(s);case"loose_item_start":for(var s="";"list_item_end"!==this.next().type;)s+=this.tok();return this.renderer.listitem(s);case"html":var l=this.token.pre||this.options.pedantic?this.token.text:this.inline.output(this.token.text);return this.renderer.html(l);case"paragraph":return this.renderer.paragraph(this.inline.output(this.token.text));case"text":return this.renderer.paragraph(this.parseText())}},u.exec=u,h.options=h.setOptions=function(e){return c(h.defaults,e),h},h.defaults={gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!1,smartLists:!1,silent:!1,highlight:null,langPrefix:"lang-",smartypants:!1,headerPrefix:"",renderer:new r,xhtml:!1},h.Parser=o,h.parser=o.parse,h.Renderer=r,h.Lexer=e,h.lexer=e.lex,h.InlineLexer=i,h.inlineLexer=i.output,h.parse=h,"undefined"!=typeof t&&"object"==typeof n?t.exports=h:"function"==typeof define&&define.amd?define(function(){return h}):this.marked=h}).call(function(){return this||("undefined"!=typeof window?window:e)}())}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],23:[function(e,t,n){"use strict";function i(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.exports=function(e,t,n,o){t=t||"&",n=n||"=";var s={};if("string"!=typeof e||0===e.length)return s;var a=/\+/g;e=e.split(t);var l=1e3;o&&"number"==typeof o.maxKeys&&(l=o.maxKeys);var u=e.length;l>0&&u>l&&(u=l);for(var c=0;u>c;++c){var h,d,f,p,g=e[c].replace(a,"%20"),m=g.indexOf(n);m>=0?(h=g.substr(0,m),d=g.substr(m+1)):(h=g,d=""),f=decodeURIComponent(h),p=decodeURIComponent(d),i(s,f)?r(s[f])?s[f].push(p):s[f]=[s[f],p]:s[f]=p}return s};var r=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{}],24:[function(e,t,n){"use strict";function i(e,t){if(e.map)return e.map(t);for(var n=[],i=0;i<e.length;i++)n.push(t(e[i],i));return n}var r=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};t.exports=function(e,t,n,a){return t=t||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?i(s(e),function(s){var a=encodeURIComponent(r(s))+n;return o(e[s])?i(e[s],function(e){return a+encodeURIComponent(r(e))}).join(t):a+encodeURIComponent(r(e[s]))}).join(t):a?encodeURIComponent(r(a))+n+encodeURIComponent(r(e)):""};var o=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},s=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}},{}],25:[function(e,t,n){"use strict";n.decode=n.parse=e("./decode"),n.encode=n.stringify=e("./encode")},{"./decode":23,"./encode":24}],26:[function(e,t,n){"use strict";var i=e("querystring"),r=e("./content-manager"),o=e("./screen-default");document.addEventListener("DOMContentLoaded",function(){var e=document.body.querySelector("#content"),t=i.parse(location.search.substring(1));if(t.story){var n=r.create(e);n.load(t.story)}else o.create(e)})},{"./content-manager":2,"./screen-default":5,querystring:25}]},{},[26]);